<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Denis Medeiros &lt;denis@dimap.ufrn.br&gt;, Pedro Henrique &lt;pedrohenriquedemedeiros@gmail.com&gt;">
<title>DCA0445 - Processamento Digital de Imagens</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #444444; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #111111; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.95em; font-style: normal !important; letter-spacing: 0; padding: 0; background-color: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.2; color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #333333; }

kbd { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; display: inline-block; color: black; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #111111; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #748590; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #909ea7; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #909ea7; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #111111; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #6c818f; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #465158; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #3b444a; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #111111; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #748590; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #eeeeee; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 1px solid #cccccc; -webkit-border-radius: 6px; border-radius: 6px; word-wrap: break-word; padding: 0.5em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #eeeeee; background-color: inherit; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.5em; -webkit-border-radius: 6px; border-radius: 6px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.2; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #909ea7; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #6c818f; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #748590; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #909ea7; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #748590; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 0 0 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 0 0 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 0 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 0 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 0 0 0 0; }

table.frame-all { border-width: 0; }

table.frame-sides { border-width: 0 0; }

table.frame-topbot { border-width: 0 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #465158; padding: 2em; }

#footer-text { color: #eee; font-size: 0.8em; text-align: center; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>DCA0445 - Processamento Digital de Imagens</h1>
<div class="details">
<span id="author" class="author">Denis Medeiros &lt;denis@dimap.ufrn.br&gt;, Pedro Henrique &lt;pedrohenriquedemedeiros@gmail.com&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Sumário</div>
<ul class="sectlevel1">
<li><a href="#_introdução">Introdução</a></li>
<li><a href="#_manipulando_pixels_em_uma_imagem">Manipulando pixels em uma imagem</a>
<ul class="sectlevel2">
<li><a href="#_seção_3_2_exercício_1">Seção 3.2 - Exercício 1</a></li>
<li><a href="#_seção_3_2_exercício_2">Seção 3.2 - Exercício 2</a></li>
</ul>
</li>
<li><a href="#_preenchendo_regiões">Preenchendo regiões</a>
<ul class="sectlevel2">
<li><a href="#_seção_4_2_exercício_1">Seção 4.2 - Exercício 1</a></li>
<li><a href="#_seção_4_2_exercício_2">Seção 4.2 - Exercício 2</a></li>
</ul>
</li>
<li><a href="#_manipulação_de_histogramas">Manipulação de Histogramas</a>
<ul class="sectlevel2">
<li><a href="#_seção_5_2_exercício_1">Seção 5.2 - Exercício 1</a></li>
<li><a href="#_seção_5_2_exercício_2">Seção 5.2 - Exercício 2</a></li>
</ul>
</li>
<li><a href="#_filtragem_espacial_i">Filtragem Espacial I</a>
<ul class="sectlevel2">
<li><a href="#_seção_6_2_exercício_1">Seção 6.2 Exercício 1</a></li>
</ul>
</li>
<li><a href="#_filtragem_espacial_ii">Filtragem Espacial II</a>
<ul class="sectlevel2">
<li><a href="#_seção_7_1_exercício_1">Seção 7.1 - Exercício 1</a></li>
<li><a href="#_seção_7_1_exercício_2">Seção 7.1 - Exercício 2</a></li>
</ul>
</li>
<li><a href="#_filtragem_no_domínio_da_frequência">Filtragem no domínio da frequência</a>
<ul class="sectlevel2">
<li><a href="#_seção_8_2_exercício_1">Seção 8.2 - Exercício 1</a></li>
</ul>
</li>
<li><a href="#_canny_e_a_arte_com_pontilhismo">Canny e a arte com pontilhismo</a>
<ul class="sectlevel2">
<li><a href="#_seção_11_1_exercício_1">Seção 11.1 - Exercício 1</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introdução">Introdução</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Esta página contém uma série de exercícios sobre processamento digital de imagens implementados em C++ com a biblioteca OpenCV. Todos eles, assim como os textos introdutórios, são de crédito do professor Dr. <a href="http://agostinhobritojr.github.io/" target="_blank">Agostinho de Medeiros Brito Junior</a>, professor da Universidade Federal do Rio Grande do Norte e responsável pelo curso <a href="http://agostinhobritojr.github.io/tutoriais/pdi/" target="_blank">DCA0445 - Processamento Digital de Imagens</a>.</p>
</div>
<div class="paragraph">
<p>Observação importante: vários dos exercícios foram resolvidos com as imagens sendo tratadas em escala de cinza, mas a maioria dos algoritmos usados poderiam ser aplicados em imagens coloridas sem muita dificuldade e com pouca alteração no código fonte.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manipulando_pixels_em_uma_imagem">Manipulando pixels em uma imagem</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_3_2_exercício_1">Seção 3.2 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/pixels.cpp" target="_blank">exemplos/pixels.cpp</a> como referência, implemente um  programa regions.cpp. Esse programa deverá solicitar ao usuário as coordenadas  de dois pontos \$P_1\$ e \$P_2\$  localizados dentro dos limites do  tamanho da imagem e exibir que lhe for fornecida. Entretanto, a região definida  pelo retângulo de vértices opostos definidos pelos pontos \$P_1\$ e \$P_2\$ será exibida com o negativo da imagem na região correspondente.</p>
</div>
<div class="paragraph">
<p>O efeito é ilustrado na figura regiões (abaixo).</p>
</div>
<div id="img-regioes" class="imageblock">
<div class="content">
<img src="./img/regioes.png" alt="Regiões">
</div>
<div class="title">Figura 1. Figura regioes.png</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Para resolver o exercício acima, o seguinte programa foi desenvolvido:</p>
</div>
<div id="regioes" class="listingblock">
<div class="title">regioes.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-cm">/*</span>
<span class="tok-cm"> * argv[1] = imagem</span>
<span class="tok-cm"> * argv[2] = p1.x</span>
<span class="tok-cm"> * argv[3] = p1.y</span>
<span class="tok-cm"> * argv[4] = p2.x</span>
<span class="tok-cm"> * argv[5] = p2.y</span>
<span class="tok-cm"> */</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>
    <span class="tok-n">Vec3b</span> <span class="tok-n">atual</span><span class="tok-p">,</span> <span class="tok-n">novo</span><span class="tok-p">;</span>
    <span class="tok-n">Point</span> <span class="tok-n">p1</span><span class="tok-p">,</span> <span class="tok-n">p2</span><span class="tok-p">;</span>
    <span class="tok-n">Rect</span> <span class="tok-n">ret</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Verifica a quantidade de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">6</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: ./regioes &lt;imagem&gt; &lt;ponto1_x&gt; &quot;</span>
                                    <span class="tok-s">&quot;&lt;ponto1_y&gt; &lt;ponto2_x&gt; &lt;ponto2_y&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Verifica se a imagem pode ser aberta. */</span>
    <span class="tok-n">imagem</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Verifica se todas as coordenadas fornecidas são números. */</span>
    <span class="tok-k">try</span>
    <span class="tok-p">{</span>
        <span class="tok-n">p1</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">stoi</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]);</span>
        <span class="tok-n">p1</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">stoi</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]);</span>
        <span class="tok-n">p2</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">stoi</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">]);</span>
        <span class="tok-n">p2</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">stoi</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">5</span><span class="tok-p">]);</span>
    <span class="tok-p">}</span>
    <span class="tok-k">catch</span> <span class="tok-p">(</span><span class="tok-k">const</span> <span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">exception</span><span class="tok-o">&amp;</span> <span class="tok-n">e</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Uma ou mais coordenadas não é válida.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">3</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Vericfica os pontos estão dentro da imagem. */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">p1</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span> <span class="tok-o">||</span> <span class="tok-n">p1</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Ponto 1 está fora da imagem.&quot;</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">4</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">p2</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span> <span class="tok-o">||</span> <span class="tok-n">p2</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Ponto 2 está fora da imagem..&quot;</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">4</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">ret</span> <span class="tok-o">=</span> <span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-n">p1</span><span class="tok-p">,</span> <span class="tok-n">p2</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Calcula o negativo da região retangular formada pelos dois pontos. */</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">ret</span><span class="tok-p">.</span><span class="tok-n">x</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">ret</span><span class="tok-p">.</span><span class="tok-n">height</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">ret</span><span class="tok-p">.</span><span class="tok-n">y</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">ret</span><span class="tok-p">.</span><span class="tok-n">width</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-mi">255</span> <span class="tok-o">-</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-p">;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;saida.png&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">);</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">);</span>
    <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">10000</span><span class="tok-p">);</span>

    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A estratégia adotada neste programa consiste em receber do usuário dois pontos, criar um retângulo a partir deles e calcular o negativo deste retângulo. Ele representará a região da foto que será negativada, logo precisará está contido dentro da matriz da imagem.</p>
</div>
<div class="paragraph">
<p>As primeiras linhas do programa (linha 22 à linha 62) consiste na validação dos dados fornecidos pelo usuário, ou seja, se o usuário inseriu o número correto as coordenadas x e y de dois pontos, se a imagem é válida e se o retângulo está contido dentro da figura.</p>
</div>
<div class="paragraph">
<p>Uma vez que os dois pontos são válidos, é criado um retângulo (linha 64) e, finalmente, é relizado uma iteração sob todos aqueles pixels representados pelo retângulo dentro da própria matriz <strong>imagem</strong> (linha 67 à linha 73), de modo que é calculado o negativo de cada pixel subtraindo seu  valor de 255. Por fim, a imagem processada é exibida na tela.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./regioes onca.png 20 20 200 200</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-onca" class="imageblock">
<div class="content">
<img src="./img/onca.png" alt="Regiões">
</div>
<div class="title">Figura 2. Figura onca.png original</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Foto de saída:</p>
</li>
</ul>
</div>
<div id="img-onca-regions" class="imageblock">
<div class="content">
<img src="./img/onca-regioes.png" alt="Regiões">
</div>
<div class="title">Figura 3. Figura onca.png após processamento</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seção_3_2_exercício_2">Seção 3.2 - Exercício 2</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/pixels.cpp" target="_blank">exemplos/pixels.cpp</a> como referência, implemente um programa trocaregioes.cpp. Seu programa deverá trocar os quadrantes em diagonal na imagem. Explore o uso da classe Mat e seus construtores para criar as regiões que serão trocadas. O efeito é ilustrado na Figura Troca de regiões (abaixo).</p>
</div>
<div id="img-regioes" class="imageblock">
<div class="content">
<img src="./img/trocaregioes.png" alt="Troca Regiões">
</div>
<div class="title">Figura 4. Figura trocaregioes.png</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A versão modificada do programa pixels.cpp pode ser vista abaixo:</p>
</div>
<div id="trocaregioes" class="listingblock">
<div class="title">trocaregioes.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-cm">/*</span>
<span class="tok-cm"> * argv[1] = imagem</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> *  Esquema dos quadrantes.</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> *    q1  |   q2</span>
<span class="tok-cm"> *   ____________</span>
<span class="tok-cm"> *    q3  |   q4</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> */</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">,</span> <span class="tok-n">q1</span><span class="tok-p">,</span> <span class="tok-n">q2</span><span class="tok-p">,</span> <span class="tok-n">q3</span><span class="tok-p">,</span> <span class="tok-n">q4</span><span class="tok-p">,</span> <span class="tok-n">temp1</span><span class="tok-p">,</span> <span class="tok-n">temp2</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Verifica o número de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: &quot;</span>
                                            <span class="tok-s">&quot;./trocaregioes &lt;imagem&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Checa se a imagem pode ser aberta. */</span>
    <span class="tok-n">imagem</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Cria sub-matrizes representando cada quadrante da figura. */</span>
    <span class="tok-n">q1</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">));</span>
    <span class="tok-n">q2</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">));</span>
    <span class="tok-n">q3</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">));</span>
    <span class="tok-n">q4</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span>
                <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">));</span>

    <span class="tok-cm">/* Une os quadrantes q4 e q3 horizontalmente para construir a metade</span>
<span class="tok-cm">     * superior da imagem. Este resultado parcial é armazenado em temp1.</span>
<span class="tok-cm">     */</span>
    <span class="tok-n">hconcat</span><span class="tok-p">(</span><span class="tok-n">q4</span><span class="tok-p">,</span> <span class="tok-n">q3</span><span class="tok-p">,</span> <span class="tok-n">temp1</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Une os quadrantes q2 e q1 horizontalmente para construir a metade</span>
<span class="tok-cm">     * inferior da imagem. Este resultado parcial é armazenado em temp2.</span>
<span class="tok-cm">     */</span>
    <span class="tok-n">hconcat</span><span class="tok-p">(</span><span class="tok-n">q2</span><span class="tok-p">,</span> <span class="tok-n">q1</span><span class="tok-p">,</span> <span class="tok-n">temp2</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Finalmente, une verticialmente os dois resultados parciais anteriores</span>
<span class="tok-cm">     * para montar o resultado final.</span>
<span class="tok-cm">     */</span>
    <span class="tok-n">vconcat</span><span class="tok-p">(</span><span class="tok-n">temp1</span><span class="tok-p">,</span> <span class="tok-n">temp2</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">);</span>

    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;saida.png&quot;</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">);</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">);</span>
    <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">10000</span><span class="tok-p">);</span>

    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para atender os requisitos do problema, a ideia do programa acima foi criar 4 sub-matrizes representando cada quadrante para que depois elas pudessem ser concantenadas em uma nova matriz, de modo a representar os quadrantes trocados.</p>
</div>
<div class="paragraph">
<p>A criação das submatrizes ocorrem utilizando o próprio construtor da classe <strong>Mat</strong> (da linha 39 à 42), que permite receber a matriz original e um retângulo representando a sub-matriz a ser extraída para criação da nova imagem. Os retângulos são montados tomando como referência o início, fim e pontos médios horizontais e verticais da imagem original.</p>
</div>
<div class="paragraph">
<p>Com as submatrizes criadas, primeiro são montadas as partes superior e inferior do resultado final (linhas 48 e 53), através da função <strong>hconcat</strong>, que primeiro realiza o concatenamento horizontal da metade de baixo da figura original e depois o concatenamento da metade de cima da figura original. Com esses dois resultados intermediários, por fim, é realizado um concatenamento vertical (linha 58), com a função <strong>vconcat</strong>, que produz o resultado final.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./trocaregioes gato.png</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-gato" class="imageblock">
<div class="content">
<img src="./img/gato.png" alt="Troca Regioes" width="400" height="400">
</div>
<div class="title">Figura 5. Figura gato.png original</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Foto de saída:</p>
</li>
</ul>
</div>
<div id="img-gato-trocaregioes" class="imageblock">
<div class="content">
<img src="./img/gato-trocaregioes.png" alt="Regiões" width="400" height="400">
</div>
<div class="title">Figura 6. Figura gato.png após processamento</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preenchendo_regiões">Preenchendo regiões</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_4_2_exercício_1">Seção 4.2 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Observando-se o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/labeling.cpp">labeling.cpp</a> como exemplo, é possível verificar que caso existam mais de 255 objetos na cena, o processo de rotulação poderá ficar comprometido. Identifique a situação em que isso ocorre e proponha uma solução para este problema.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>O algoritmo padrão de labeling fornecido pelo professor contem um problema, pois utiliza a própria cor do pixel rotulado para armazenar a contagem de elementos. No caso de uma imagem em escala de cinza, em que cada pixel é representado por 1 byte, logo poder-se-ia contar apenas 256 elementos. Uma abordagem diferente seria utilizar a cor do pixel como um tipo de classificação para os objetos contados, de modo que os pixels de uma mesma categoria assumam apenas o papel de rótulo, sendo reservado um contador à parte para contar quantos elementos dessa categoria foram encontrados.</p>
</div>
</div>
<div class="sect2">
<h3 id="_seção_4_2_exercício_2">Seção 4.2 - Exercício 2</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Aprimore o algoritmo de contagem apresentado para identificar regiões com ou sem buracos internos que existam na cena. Assuma que objetos com mais de um buraco podem existir. Inclua suporte no seu algoritmo para não contar bolhas que tocam as bordas da imagem. Não se pode presumir, a priori, que elas tenham buracos ou não.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>O programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/labeling.cpp">labeling.cpp</a>, disponibilizado pelo professor, foi adaptado e o resultado final pode ser visto abaixo:</p>
</div>
<div id="rotulacao" class="listingblock">
<div class="title">rotulacao.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-cp">#define COR_FUNDO_PADRAO 0</span>
<span class="tok-cp">#define COR_BOLHA 255</span>
<span class="tok-cp">#define COR_FUNDO_ALTERADA 192</span>
<span class="tok-cp">#define COR_BURACO 96</span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-cm">/*</span>
<span class="tok-cm"> * argv[1] = imagem</span>
<span class="tok-cm"> */</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span> <span class="tok-o">**</span><span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>
    <span class="tok-n">Point</span> <span class="tok-n">p</span><span class="tok-p">;</span>
    <span class="tok-n">uint</span> <span class="tok-n">bolhasEncontradas</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Verifica a quantidade de argumentos. */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: ./rotulacao &lt;imagem&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Verifica se a imagem pode ser aberta. */</span>
    <span class="tok-n">imagem</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="tok-p">);</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Primeiramente remove as bolhas das bordas */</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">COR_BOLHA</span><span class="tok-p">)</span>
            <span class="tok-p">{</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-p">;</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-p">;</span>
                <span class="tok-n">floodFill</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">p</span><span class="tok-p">,</span> <span class="tok-n">COR_FUNDO_PADRAO</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">+=</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">255</span><span class="tok-p">)</span>
            <span class="tok-p">{</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-p">;</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-p">;</span>
                <span class="tok-n">floodFill</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">p</span><span class="tok-p">,</span> <span class="tok-n">COR_FUNDO_PADRAO</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Altera a cor de fundo padrão para uma nova cor */</span>
    <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-n">floodFill</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">p</span><span class="tok-p">,</span> <span class="tok-n">COR_FUNDO_ALTERADA</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Conta os elementos apenas que contém buraco na cor de fundo original */</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-n">COR_FUNDO_PADRAO</span><span class="tok-p">)</span>
            <span class="tok-p">{</span>
                <span class="tok-n">bolhasEncontradas</span><span class="tok-o">++</span><span class="tok-p">;</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-p">;</span>
                <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-p">;</span>
                <span class="tok-n">floodFill</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">p</span><span class="tok-p">,</span> <span class="tok-n">COR_BURACO</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Informa ao usuário a contagem final  */</span>
    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;Há &quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">bolhasEncontradas</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot; bolhas nesa imagem.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;imagem&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">);</span>
    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;saida.png&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">);</span>
    <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">5000</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia por trás da contagem das bolhas baseiou-se no princípio de rotulação. Os rótulos foram definidos no início do programa, pois já se sabia, a princípio, quais eram as cores de fundo e dos objetos da cena (linha 4 à linha 7).</p>
</div>
<div class="paragraph">
<p>Para realizar isso, foi necessário, inicialmente, remover todos os objetos presentes nas bordas da imagem, já que não é possível saber se eles continham ou não buracos iternos na região exterior à imagem (da linha 38 à linha 61). Para isso, foi utilizado um algoritmo de <em>flood fill</em>, mudando a cor do objeto encontrado para a mesma cor de fundo da cena.</p>
</div>
<div class="paragraph">
<p>Uma vez que as imagens localizadas na borda foram removidas, o passo seguinte foi mudar a cor de fundo da cena através do mesmo algoritmo de <em>flood fill</em>, iniciando a partir do primeiro pixel da matriz da imagem (linha 64 à linha 66). Isso foi feito com o objetivo de fazer com que os elementos que continham buracos continuassem com tais buracos na cor de fundo antiga, já que, caso um objeto desses não fosse completamente fechado, o buraco seria preenchido pela nova cor de fundo.</p>
</div>
<div class="paragraph">
<p>Por fim, foi feita uma busca na imagem por qualquer região que ainda estivesse rotulado com a cor de fundo inicial (linha 69 à 81). Tal região seria, consequentemente, um buraco dentro de um objeto. Assim, o número de bolhas seria exatamente igual ao número de buracos encontrados.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./rotulacao bolhas.png</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-bolhas" class="imageblock">
<div class="content">
<img src="./img/bolhas.png" alt="Troca Regioes" width="400" height="400">
</div>
<div class="title">Figura 7. Figura bolhas.png original</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Foto de saída:</p>
</li>
</ul>
</div>
<div id="img-gato-trocaregioes" class="imageblock">
<div class="content">
<img src="./img/bolhas-rotulacao.png" alt="Regiões" width="400" height="400">
</div>
<div class="title">Figura 8. Figura bolhas.png após processamento</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Saída do programa:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>"Há 7 bolhas nesa imagem."</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manipulação_de_histogramas">Manipulação de Histogramas</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_5_2_exercício_1">Seção 5.2 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/histogram.cpp" target="_blank">exemplos/histogram.cpp</a> como referência, implemente um programa equalize.cpp. Este deverá, para cada imagem capturada, realizar a equalização do histogram antes de exibir a imagem. Teste sua implementação apontando a câmera para ambientes com iluminações variadas e observando o efeito gerado. Assuma que as imagens processadas serão em tons de cinza.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>O programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/histogram.cpp">histogram.cpp</a>, disponibilizado pelo professor, foi adaptado e o resultado final pode ser visto abaixo:</p>
</div>
<div id="equalizador" class="listingblock">
<div class="title">equalizador.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">VideoCapture</span> <span class="tok-n">cap</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagemOriginal</span><span class="tok-p">,</span> <span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">imagemEqualizada</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">histImagemEqualizada</span><span class="tok-p">;</span>
    <span class="tok-c1">//Mat histImagemEscalaCinzaImg, histImagemEqualizadaImg;</span>

    <span class="tok-cm">/* Níveis de matiz */</span>
    <span class="tok-kt">int</span> <span class="tok-n">hbins</span> <span class="tok-o">=</span> <span class="tok-mi">128</span><span class="tok-p">;</span>
    <span class="tok-cm">/* Níveis de saturação */</span>
    <span class="tok-kt">int</span> <span class="tok-n">sbins</span> <span class="tok-o">=</span> <span class="tok-mi">64</span><span class="tok-p">;</span>
    <span class="tok-cm">/* Tamanho do histograma */</span>
    <span class="tok-kt">int</span> <span class="tok-n">histSize</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">sbins</span><span class="tok-p">};</span>

    <span class="tok-cm">/* Matiz varia de 0 a 179 */</span>
    <span class="tok-kt">float</span> <span class="tok-n">hranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">180</span><span class="tok-p">};</span>
    <span class="tok-cm">/* Saturação varia de 0 a 255 */</span>
    <span class="tok-kt">float</span> <span class="tok-n">sranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">256</span><span class="tok-p">};</span>
    <span class="tok-cm">/* Faixas de valores do histograma */</span>
    <span class="tok-k">const</span> <span class="tok-kt">float</span><span class="tok-o">*</span> <span class="tok-n">ranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-n">hranges</span><span class="tok-p">,</span> <span class="tok-n">sranges</span> <span class="tok-p">};</span>

    <span class="tok-kt">bool</span> <span class="tok-n">uniform</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
    <span class="tok-kt">bool</span> <span class="tok-n">acummulate</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>

    <span class="tok-kt">int</span> <span class="tok-n">histw</span> <span class="tok-o">=</span> <span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">histh</span> <span class="tok-o">=</span> <span class="tok-n">sbins</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImagemEscalaCinzaImg</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC1</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImagemEqualizadaImg</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC1</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">));</span>

    <span class="tok-cm">/* Tenta abrir a câmera */</span>
    <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">isOpened</span><span class="tok-p">()){</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A captura não pôde ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-cm">/* Obtem um frame da imagem (colorida) */</span>
        <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagemOriginal</span><span class="tok-p">;</span>
        <span class="tok-cm">/* Converte o frame para escala de cinza */</span>
        <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imagemOriginal</span><span class="tok-p">,</span> <span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">CV_BGR2GRAY</span><span class="tok-p">);</span>
        <span class="tok-cm">/* Faz a equalização do histograma da imagem original. */</span>
        <span class="tok-n">equalizeHist</span><span class="tok-p">(</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">imagemEqualizada</span><span class="tok-p">);</span>

        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histImagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
             <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
             <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>

        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">imagemEqualizada</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histImagemEqualizada</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
             <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
             <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>


        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histImagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">histImagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">histImagemEscalaCinzaImg</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histImagemEqualizada</span><span class="tok-p">,</span> <span class="tok-n">histImagemEqualizada</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">histImagemEqualizadaImg</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>

        <span class="tok-n">histImagemEscalaCinzaImg</span><span class="tok-p">.</span><span class="tok-n">setTo</span><span class="tok-p">(</span><span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">));</span>
        <span class="tok-n">histImagemEqualizadaImg</span><span class="tok-p">.</span><span class="tok-n">setTo</span><span class="tok-p">(</span><span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">));</span>

        <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">hbins</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
          <span class="tok-n">line</span><span class="tok-p">(</span><span class="tok-n">histImagemEscalaCinzaImg</span><span class="tok-p">,</span>
               <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-p">),</span>
               <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-o">-</span><span class="tok-n">cvRound</span><span class="tok-p">(</span><span class="tok-n">histImagemEscalaCinza</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-kt">float</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">))),</span>
               <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
          <span class="tok-n">line</span><span class="tok-p">(</span><span class="tok-n">histImagemEqualizadaImg</span><span class="tok-p">,</span>
               <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-p">),</span>
               <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-o">-</span><span class="tok-n">cvRound</span><span class="tok-p">(</span><span class="tok-n">histImagemEqualizada</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-kt">float</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">))),</span>
               <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">8</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>

        <span class="tok-n">histImagemEscalaCinzaImg</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">40</span><span class="tok-p">,</span> <span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-p">)));</span>
        <span class="tok-n">histImagemEqualizadaImg</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">imagemEqualizada</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">40</span><span class="tok-p">,</span> <span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">histh</span><span class="tok-p">)));</span>

        <span class="tok-cm">/* Põe as duas imagens lado a lado e exibe o resultado final */</span>
        <span class="tok-n">putText</span><span class="tok-p">(</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-s">&quot;Imagem Original&quot;</span><span class="tok-p">,</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">20</span><span class="tok-p">),</span> <span class="tok-n">FONT_HERSHEY_PLAIN</span><span class="tok-p">,</span> <span class="tok-mf">1.0</span><span class="tok-p">,</span> <span class="tok-n">CV_RGB</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-mf">2.0</span><span class="tok-p">);</span>
        <span class="tok-n">putText</span><span class="tok-p">(</span><span class="tok-n">imagemEqualizada</span><span class="tok-p">,</span> <span class="tok-s">&quot;Imagem Equalizada&quot;</span><span class="tok-p">,</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">20</span><span class="tok-p">),</span> <span class="tok-n">FONT_HERSHEY_PLAIN</span><span class="tok-p">,</span> <span class="tok-mf">1.0</span><span class="tok-p">,</span> <span class="tok-n">CV_RGB</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-mf">2.0</span><span class="tok-p">);</span>
        <span class="tok-n">hconcat</span><span class="tok-p">(</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">,</span> <span class="tok-n">imagemEqualizada</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">);</span>
        <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span><span class="tok-n">resultado</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Fehca o programa ao apertar ESC */</span>
        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">30</span><span class="tok-p">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span> <span class="tok-k">break</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;ImagemOriginalEscalaCinza.png&quot;</span><span class="tok-p">,</span><span class="tok-n">imagemEscalaCinza</span><span class="tok-p">);</span>
    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;ImagemEqualizada.png&quot;</span><span class="tok-p">,</span><span class="tok-n">imagemEqualizada</span><span class="tok-p">);</span>
    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia por trás desse programa consiste em fazer a captura de uma imagem a partir da camera do computador e então fazer o processo de equalização da imagem, que consiste em uma distribuição mais uniforme dos valores da intensidade das cores, representado pelo o histograma.</p>
</div>
<div class="paragraph">
<p>Inicialmente, são definidos vários parâmetros a respeito de como os histogramas serão criados, tais como a quantidade de níveis de matiz, de saturação e o tamanho do histograma em si (linha 14 à linha 26). Uma vez que a câmera inicia a captura (linha 45), é necessário converter a imagem para escala de cinza (linha 47), pois, por padrão, o objeto da classe <em>VideoCapture</em> gera imagens coloridas.</p>
</div>
<div class="paragraph">
<p>Com a imagem obtida, o passo seguinte é gerar a sua versão equalizada (linha 49) e gerar os histogramas de versão normal e equalizada da imagem original (linha 51 à linha 57). Em seguida, é realizada a normalização de ambos os histogramas para facilitar a geração das imagens com os histogramas (linha 68 à 78) a serem sobrepostas sobre a imagem original e equalizadas (linha 80 à 82). Finalmente, ambas as imagens são mostradas lado a lado com os seus respectivos histogramas.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./equalizador</p>
</li>
<li>
<p>Fotos de saída:</p>
</li>
</ul>
</div>
<div id="img-equalizador" class="imageblock">
<div class="content">
<img src="./img/equalizador.png" alt="Equalizador">
</div>
<div class="title">Figura 9. Figura equalizador.png</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seção_5_2_exercício_2">Seção 5.2 - Exercício 2</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/histogram.cpp" target="_blank">exemplos/histogram.cpp</a> como referência, implemente um programa motiondetector.cpp. Este deverá continuamente calcular o histograma da imagem (apenas uma componente de cor é suficiente) e compará-lo com o último histograma calculado. Quando a diferença entre estes ultrapassar um limiar pré-estabelecido, ative um alarme. Utilize uma função de comparação que julgar conveniente.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>O programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/histogram.cpp">histogram.cpp</a>, disponibilizado pelo professor, foi adaptado e o resultado final pode ser visto abaixo:</p>
</div>
<div id="detectormovimento" class="listingblock">
<div class="title">detectormovimento.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;chrono&gt;</span><span class="tok-cp"></span>

<span class="tok-cm">/* Define o tempo de captura de cada imagem base. */</span>
<span class="tok-cp">#define TEMPO_NOVA_CAPTURA_MS 50</span>

<span class="tok-cm">/* Controla a sensibilidade da detecção de movimento.  */</span>
<span class="tok-cp">#define LIMIAR  0.99</span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">chrono</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">){</span>
    <span class="tok-cm">/* Imagem atual. */</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>
    <span class="tok-cm">/* Matriz para a imagem base (capturada mementos antes da atual). */</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagemBase</span><span class="tok-p">;</span>

    <span class="tok-n">VideoCapture</span> <span class="tok-n">cap</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Variável acumulador que é responsável por verificar a passagem do tempo</span>
<span class="tok-cm">     * utilzando de funções de para medir o número de ciclos e as frequências</span>
<span class="tok-cm">     * dos mesmos(do sistema operacional). */</span>
    <span class="tok-kt">double</span> <span class="tok-n">resultadoCorrelacaoR</span><span class="tok-p">,</span> <span class="tok-n">resultadoCorrelacaoG</span><span class="tok-p">,</span> <span class="tok-n">resultadoCorrelacaoB</span><span class="tok-p">;</span>

    <span class="tok-n">steady_clock</span><span class="tok-o">::</span><span class="tok-n">time_point</span> <span class="tok-n">inicio</span><span class="tok-p">,</span> <span class="tok-n">fim</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">diferencaTempo</span><span class="tok-p">;</span>

    <span class="tok-cm">/*Vetor para separar os planos RGB para os frames base e atual*/</span>
    <span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">Mat</span><span class="tok-o">&gt;</span> <span class="tok-n">planos</span><span class="tok-p">,</span> <span class="tok-n">planosBase</span><span class="tok-p">;</span>

    <span class="tok-cm">/*Cálculos dos histogramas das componentes RGB de cada frame.*/</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histR</span><span class="tok-p">,</span> <span class="tok-n">histG</span><span class="tok-p">,</span> <span class="tok-n">histB</span><span class="tok-p">,</span> <span class="tok-n">histRBase</span><span class="tok-p">,</span> <span class="tok-n">histGBase</span><span class="tok-p">,</span> <span class="tok-n">histBBase</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Níveis de matiz */</span>
    <span class="tok-kt">int</span> <span class="tok-n">hbins</span> <span class="tok-o">=</span> <span class="tok-mi">128</span><span class="tok-p">;</span>
    <span class="tok-cm">/* Níveis de saturação */</span>
    <span class="tok-kt">int</span> <span class="tok-n">sbins</span> <span class="tok-o">=</span> <span class="tok-mi">64</span><span class="tok-p">;</span>
    <span class="tok-cm">/* Tamanho do histograma */</span>
    <span class="tok-kt">int</span> <span class="tok-n">histSize</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">sbins</span><span class="tok-p">};</span>

    <span class="tok-cm">/* Matiz varia de 0 a 179 */</span>
    <span class="tok-kt">float</span> <span class="tok-n">hranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">180</span><span class="tok-p">};</span>
    <span class="tok-cm">/* Saturação varia de 0 a 255 */</span>
    <span class="tok-kt">float</span> <span class="tok-n">sranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">256</span><span class="tok-p">};</span>
    <span class="tok-cm">/* Faixas de valores do histograma */</span>
    <span class="tok-k">const</span> <span class="tok-kt">float</span><span class="tok-o">*</span> <span class="tok-n">ranges</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span> <span class="tok-n">hranges</span><span class="tok-p">,</span> <span class="tok-n">sranges</span> <span class="tok-p">};</span>

    <span class="tok-kt">bool</span> <span class="tok-n">uniform</span> <span class="tok-o">=</span> <span class="tok-nb">true</span><span class="tok-p">;</span>
    <span class="tok-kt">bool</span> <span class="tok-n">acummulate</span> <span class="tok-o">=</span> <span class="tok-nb">false</span><span class="tok-p">;</span>

    <span class="tok-kt">int</span> <span class="tok-n">histw</span> <span class="tok-o">=</span> <span class="tok-n">hbins</span><span class="tok-p">,</span> <span class="tok-n">histh</span> <span class="tok-o">=</span> <span class="tok-n">sbins</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">;</span>

    <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-cm">/* Verifica se a câmera do computador está disponível. */</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">isOpened</span><span class="tok-p">()){</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;cameras indisponiveis&quot;</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Define-se a largura e altura das imagens que serão usadas para desenhar</span>
<span class="tok-cm">     * os histogramas de cada uma das componentes de cor. As imagens são criadas</span>
<span class="tok-cm">     * com o tipo CV_8UC3, ou seja, com 8 bits por pixel, com tipo de dados</span>
<span class="tok-cm">     * unsigned char contendo 3 canais de cor. A cor, nesse caso, servirá</span>
<span class="tok-cm">     * apenas para que o histograma seja desenhado na cor respectiva de</span>
<span class="tok-cm">     * sua componente. */</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImgR</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImgG</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImgB</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>

    <span class="tok-n">Mat</span> <span class="tok-n">histImgR2</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImgG2</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">histImgB2</span><span class="tok-p">(</span><span class="tok-n">histh</span><span class="tok-p">,</span> <span class="tok-n">histw</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">));</span>

    <span class="tok-cm">/* Captura a imagem base para servir como comparação. */</span>
    <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagemBase</span><span class="tok-p">;</span>

    <span class="tok-n">inicio</span> <span class="tok-o">=</span> <span class="tok-n">chrono</span><span class="tok-o">::</span><span class="tok-n">steady_clock</span><span class="tok-o">::</span><span class="tok-n">now</span><span class="tok-p">();</span>

    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">){</span>

        <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>

        <span class="tok-n">fim</span> <span class="tok-o">=</span> <span class="tok-n">chrono</span><span class="tok-o">::</span><span class="tok-n">steady_clock</span><span class="tok-o">::</span><span class="tok-n">now</span><span class="tok-p">();</span>
        <span class="tok-n">diferencaTempo</span> <span class="tok-o">=</span> <span class="tok-n">duration_cast</span><span class="tok-o">&lt;</span><span class="tok-n">milliseconds</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">fim</span> <span class="tok-o">-</span> <span class="tok-n">inicio</span><span class="tok-p">).</span><span class="tok-n">count</span><span class="tok-p">();</span>

        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">diferencaTempo</span> <span class="tok-o">&gt;</span> <span class="tok-n">TEMPO_NOVA_CAPTURA_MS</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagemBase</span><span class="tok-p">;</span>
            <span class="tok-n">inicio</span> <span class="tok-o">=</span> <span class="tok-n">chrono</span><span class="tok-o">::</span><span class="tok-n">steady_clock</span><span class="tok-o">::</span><span class="tok-n">now</span><span class="tok-p">();</span>
        <span class="tok-p">}</span>

        <span class="tok-cm">/* Separa os planos R, G e B da imagem que serve como base. */</span>
        <span class="tok-n">split</span> <span class="tok-p">(</span><span class="tok-n">imagemBase</span><span class="tok-p">,</span> <span class="tok-n">planosBase</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Calcula o histograma para os 3 canais de cores da imagem base. */</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planosBase</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histRBase</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planosBase</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histGBase</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planosBase</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histBBase</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>

         <span class="tok-cm">/* Separa os planos R, G e B da imagem atual. */</span>
        <span class="tok-n">split</span> <span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">planos</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Calcula o histograma para os 3 canais de cores da imagem atual. */</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histR</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                    <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histG</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>
        <span class="tok-n">calcHist</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">],</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">(),</span> <span class="tok-n">histB</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">histSize</span><span class="tok-p">,</span> <span class="tok-n">ranges</span><span class="tok-p">,</span>
                <span class="tok-n">uniform</span><span class="tok-p">,</span> <span class="tok-n">acummulate</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Faz a normalização dos histogramas de cada canal de cor. */</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histR</span><span class="tok-p">,</span> <span class="tok-n">histR</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histG</span><span class="tok-p">,</span> <span class="tok-n">histG</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histB</span><span class="tok-p">,</span> <span class="tok-n">histB</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>

        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histRBase</span><span class="tok-p">,</span> <span class="tok-n">histRBase</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histGBase</span><span class="tok-p">,</span> <span class="tok-n">histGBase</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>
        <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">histBBase</span><span class="tok-p">,</span> <span class="tok-n">histBBase</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">NORM_MINMAX</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-p">());</span>

        <span class="tok-cm">/* Utiliza o método da correlação para comparar os histogramas de todos</span>
<span class="tok-cm">         * os canais de cores. */</span>
        <span class="tok-n">resultadoCorrelacaoR</span> <span class="tok-o">=</span> <span class="tok-n">compareHist</span><span class="tok-p">(</span><span class="tok-n">histRBase</span><span class="tok-p">,</span> <span class="tok-n">histR</span><span class="tok-p">,</span> <span class="tok-n">CV_COMP_CORREL</span><span class="tok-p">);</span>
        <span class="tok-n">resultadoCorrelacaoG</span> <span class="tok-o">=</span> <span class="tok-n">compareHist</span><span class="tok-p">(</span><span class="tok-n">histGBase</span><span class="tok-p">,</span> <span class="tok-n">histG</span><span class="tok-p">,</span> <span class="tok-n">CV_COMP_CORREL</span><span class="tok-p">);</span>
        <span class="tok-n">resultadoCorrelacaoB</span> <span class="tok-o">=</span> <span class="tok-n">compareHist</span><span class="tok-p">(</span><span class="tok-n">histBBase</span><span class="tok-p">,</span> <span class="tok-n">histB</span><span class="tok-p">,</span> <span class="tok-n">CV_COMP_CORREL</span><span class="tok-p">);</span>

        <span class="tok-cm">/*</span>
<span class="tok-cm">        cout &lt;&lt;  &quot;Resultado da método da comparação R: &quot;&lt;&lt; resultadoCorrelacaoR</span>
<span class="tok-cm">             &lt;&lt; endl;</span>
<span class="tok-cm">        cout &lt;&lt;  &quot;Resultado da método da comparação G: &quot;&lt;&lt; resultadoCorrelacaoG</span>
<span class="tok-cm">             &lt;&lt; endl;</span>
<span class="tok-cm">        cout &lt;&lt;  &quot;Resultado da método da comparação B: &quot;&lt;&lt; resultadoCorrelacaoB</span>
<span class="tok-cm">             &lt;&lt; endl;</span>
<span class="tok-cm">        cout &lt;&lt; &quot;--------------------------------------------------&quot; &lt;&lt; endl;</span>
<span class="tok-cm">        */</span>

        <span class="tok-cm">/* Verifica se pelo menos um dos resultados está abaixo do limiar. Caso</span>
<span class="tok-cm">         * esteja, é porque houve variação no histograma e, por consguinte,</span>
<span class="tok-cm">         * houve algum movimento.</span>
<span class="tok-cm">         */</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">resultadoCorrelacaoR</span> <span class="tok-o">&lt;</span> <span class="tok-n">LIMIAR</span> <span class="tok-o">||</span> <span class="tok-n">resultadoCorrelacaoG</span> <span class="tok-o">&lt;</span> <span class="tok-n">LIMIAR</span> <span class="tok-o">||</span>
            <span class="tok-n">resultadoCorrelacaoB</span> <span class="tok-o">&lt;</span> <span class="tok-n">LIMIAR</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">putText</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-s">&quot;Movimento Detectado&quot;</span><span class="tok-p">,</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-mi">40</span><span class="tok-p">),</span>
                            <span class="tok-n">FONT_HERSHEY_TRIPLEX</span><span class="tok-p">,</span> <span class="tok-mf">1.0</span><span class="tok-p">,</span> <span class="tok-n">CV_RGB</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">255</span><span class="tok-p">,</span><span class="tok-mi">0</span><span class="tok-p">),</span> <span class="tok-mf">2.0</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>

        <span class="tok-cm">/* Verifica se a variável acumulador chegou ao valor preestabelicido</span>
<span class="tok-cm">         * pelo programador. */</span>

        <span class="tok-c1">//imshow(&quot;base&quot;, imagemBase);</span>
        <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;imagem&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagem</span><span class="tok-p">);</span>

        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">30</span><span class="tok-p">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia básica do programa é fazer o uso de duas imagens, uma sendo uma imagem base, para servir como referência, e outra uma imagem atal, que fica sendo obtida constamente atualizada a partir da câmera do computador, com o objetivo de comparar seus histogramas para detectar presença de movimento na cena monitorada. Essa imagem base é capturada a cada intervalo de tempo específico e é feita uma comparação de seu histograma com o histograma da imagem recentemente capturada. Caso haja uma diferença significativa entre os histogramas, então é porque houve mudança na cena, o que sugere presença de movimento.</p>
</div>
<div class="paragraph">
<p>Os parâmetros da frequência de captura da imagem que serve como base e do limiar de comparação dos histogramas são definidos logo no início (linha 6 à linha 9). Os parâmetros relacionados aos formatos do histograma seguem no início da função <strong>main</strong> (linha 38 à linha 54).</p>
</div>
<div class="paragraph">
<p>A captura da imagem atual é feita constantemente no início do <em>loop</em> principal (linha 84) e, logo em seguida, é verificado se já passou o tempo para a captura de uma nova imagem base (linha 86 à 93). Após isso, ambas as imagens são divididas em seus 3 canais de cores, para que seja possível calcular o histograma de cada canal, bem como ser feita a normalização de cada um deles (linha 96 à 124). Esses procedimentos são semelhantes no quesito que os seus códigos estão cumprindo a mesma função do que os códigos do exercício 1 desta seção, com a diferença que aqui trabalha-se com 3 planos  (RBG) em vez de 1 (escala de cinza).</p>
</div>
<div class="paragraph">
<p>Com todos os histogramas prontos e normalizados, é feita uma comparação entre eles através da função <strong>compareHist</strong>, utilizando o método da correlação. Pelos testes feitos, quanto mais parecido um histograma é do outro, mais próximo de 1 o resultado desta função se aproxima. Por exemplo, estimando um limiar 0.99, estima-se que os histogramas são parecidos em 99% de seus componentes. Assim, tal teste é feito (linha 146 à linha 151) e, caso o histograma da imagem atual seja menos de 99% semelhante ao da imagem base, então considerou-se que ocorreu movimento na cena. Tal resultado é exibido na tela.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./detectormovimento</p>
</li>
<li>
<p>Fotos de saída:</p>
</li>
</ul>
</div>
<div id="video-detectormovimento" class="videoblock">
<div class="title">Vídeo detectormovimento.mp4</div>
<div class="content">
<video src="./img/detectormovimento.mp4" width="640" poster="./img/Detector de Movimento" autoplay controls loop>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filtragem_espacial_i">Filtragem Espacial I</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_6_2_exercício_1">Seção 6.2 Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/filtroespacial.cpp">exemplos/filtroespacial.cpp</a> como referência, implemente um programa laplgauss.cpp. O programa deverá acrescentar mais uma funcionalidade ao exemplo fornecido, permitindo que seja calculado o laplaciano do gaussiano das imagens capturadas. Compare o resultado desse filtro com a simples aplicação do filtro laplaciano.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>O programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/filtroespacial.cpp">filtroespacial.cpp</a>, disponibilizado pelo professor, foi adaptado para que o novo filtro ficasse disponível quando o usuário digitasse a tecla 'p':</p>
</div>
<div id="laplgauss" class="listingblock">
<div class="title">laplgauss.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-cm">/* Definição de todas as máscaras dos filtros */</span>
<span class="tok-kt">float</span> <span class="tok-n">media</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">1</span>
<span class="tok-p">};</span>
<span class="tok-kt">float</span> <span class="tok-n">gauss</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
    <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">4</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>
    <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">1</span>
<span class="tok-p">};</span>
<span class="tok-kt">float</span> <span class="tok-n">horizontal</span><span class="tok-p">[]</span><span class="tok-o">=</span><span class="tok-p">{</span>
    <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>
    <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">1</span>
<span class="tok-p">};</span>
<span class="tok-kt">float</span> <span class="tok-n">vertical</span><span class="tok-p">[]</span><span class="tok-o">=</span><span class="tok-p">{</span>
    <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>
     <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
     <span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">1</span>
<span class="tok-p">};</span>
<span class="tok-kt">float</span> <span class="tok-n">laplacian</span><span class="tok-p">[]</span><span class="tok-o">=</span><span class="tok-p">{</span>
     <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
    <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>
     <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span>
<span class="tok-p">};</span>

<span class="tok-cm">/* Resultado da convolução digital dos filtros gauss e laplacian acima.</span>
<span class="tok-cm"> * Ela pode ser feita à mão ou utilizando alguma ferramenta como Simulink</span>
<span class="tok-cm"> *   ou Python + numpy+ scipy (exemplo em anexo).</span>
<span class="tok-cm"> */</span>
<span class="tok-kt">float</span> <span class="tok-n">laplgauss</span><span class="tok-p">[]</span><span class="tok-o">=</span><span class="tok-p">{</span>
    <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">8</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>  <span class="tok-mi">2</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>
    <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span>  <span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-p">};</span>

<span class="tok-cm">/* Exibe a máscara na saída padrão */</span>
<span class="tok-kt">void</span> <span class="tok-nf">printMask</span><span class="tok-p">(</span><span class="tok-n">Mat</span> <span class="tok-o">&amp;</span><span class="tok-n">m</span><span class="tok-p">){</span>
    <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">().</span><span class="tok-n">height</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">().</span><span class="tok-n">width</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">m</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-kt">float</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span><span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;,&quot;</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Exibe o menu principal */</span>
<span class="tok-kt">void</span> <span class="tok-nf">menu</span><span class="tok-p">(){</span>
    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;</span><span class="tok-se">\n</span><span class="tok-s">Pressione a tecla para ativar o filtro: </span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;a - Calcular módulo</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;m - Média</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;g - Gauss</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;v - Vertical</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;h - Horizontal</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;l - Laplaciano</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;p - Laplaciano do Gaussiano</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span>
    <span class="tok-s">&quot;ESC - Sair</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argvc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">){</span>
    <span class="tok-n">VideoCapture</span> <span class="tok-n">video</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">cap</span><span class="tok-p">,</span> <span class="tok-n">frame</span><span class="tok-p">,</span> <span class="tok-n">frame32f</span><span class="tok-p">,</span> <span class="tok-n">frameFiltered</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">mask</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">CV_32F</span><span class="tok-p">),</span> <span class="tok-n">mask1</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">result</span><span class="tok-p">,</span> <span class="tok-n">result1</span><span class="tok-p">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">width</span><span class="tok-p">,</span> <span class="tok-n">height</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">absolut</span><span class="tok-p">;</span>
    <span class="tok-kt">char</span> <span class="tok-n">key</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Tenta abrir o vídeo. */</span>
    <span class="tok-n">video</span><span class="tok-p">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">video</span><span class="tok-p">.</span><span class="tok-n">isOpened</span><span class="tok-p">())</span>
    <span class="tok-p">{</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">video</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FRAME_WIDTH</span><span class="tok-p">);</span>
    <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">video</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FRAME_HEIGHT</span><span class="tok-p">);</span>
    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;largura=&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">width</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">;;</span>
    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;altura =&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">height</span><span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;</span><span class="tok-se">\n</span><span class="tok-s">&quot;</span><span class="tok-p">;;</span>

    <span class="tok-cm">/* Cria as duas janelas */</span>
    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;original&quot;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;filtroespacial&quot;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">);</span>

    <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">media</span><span class="tok-p">);</span>
    <span class="tok-n">scaleAdd</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-o">/</span><span class="tok-mf">9.0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-o">::</span><span class="tok-n">zeros</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">CV_32F</span><span class="tok-p">),</span> <span class="tok-n">mask1</span><span class="tok-p">);</span>
    <span class="tok-n">swap</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">,</span> <span class="tok-n">mask1</span><span class="tok-p">);</span>
    <span class="tok-n">absolut</span><span class="tok-o">=</span><span class="tok-mi">1</span><span class="tok-p">;</span> <span class="tok-c1">// calcs abs of the image</span>

    <span class="tok-n">menu</span><span class="tok-p">();</span>

    <span class="tok-k">for</span><span class="tok-p">(;;)</span>
    <span class="tok-p">{</span>
        <span class="tok-cm">/* Faz a captura do vídeo e converte para escala de cinza */</span>
        <span class="tok-n">video</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">cap</span><span class="tok-p">;</span>
        <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">cap</span><span class="tok-p">,</span> <span class="tok-n">frame</span><span class="tok-p">,</span> <span class="tok-n">CV_BGR2GRAY</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Gira a imagem horizontalmente */</span>
        <span class="tok-n">flip</span><span class="tok-p">(</span><span class="tok-n">frame</span><span class="tok-p">,</span> <span class="tok-n">frame</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
        <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;original&quot;</span><span class="tok-p">,</span> <span class="tok-n">frame</span><span class="tok-p">);</span>
        <span class="tok-n">frame</span><span class="tok-p">.</span><span class="tok-n">convertTo</span><span class="tok-p">(</span><span class="tok-n">frame32f</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">);</span>

        <span class="tok-cm">/* Aplica o filtro selecionado (filtro inicial: média) */</span>
        <span class="tok-n">filter2D</span><span class="tok-p">(</span><span class="tok-n">frame32f</span><span class="tok-p">,</span> <span class="tok-n">frameFiltered</span><span class="tok-p">,</span> <span class="tok-n">frame32f</span><span class="tok-p">.</span><span class="tok-n">depth</span><span class="tok-p">(),</span> <span class="tok-n">mask</span><span class="tok-p">,</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">),</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">absolut</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">frameFiltered</span><span class="tok-o">=</span><span class="tok-n">abs</span><span class="tok-p">(</span><span class="tok-n">frameFiltered</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
        <span class="tok-n">frameFiltered</span><span class="tok-p">.</span><span class="tok-n">convertTo</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">,</span> <span class="tok-n">CV_8U</span><span class="tok-p">);</span>
        <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;filtroespacial&quot;</span><span class="tok-p">,</span> <span class="tok-n">result</span><span class="tok-p">);</span>
        <span class="tok-n">key</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kt">char</span><span class="tok-p">)</span> <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">);</span>
        <span class="tok-k">if</span><span class="tok-p">(</span> <span class="tok-n">key</span> <span class="tok-o">==</span> <span class="tok-mi">27</span> <span class="tok-p">)</span> <span class="tok-k">break</span><span class="tok-p">;</span> <span class="tok-c1">// esc pressed!</span>

        <span class="tok-k">switch</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;a&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">absolut</span><span class="tok-o">=!</span><span class="tok-n">absolut</span><span class="tok-p">;</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;m&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">media</span><span class="tok-p">);</span>
                <span class="tok-n">scaleAdd</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-o">/</span><span class="tok-mf">9.0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-o">::</span><span class="tok-n">zeros</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">CV_32F</span><span class="tok-p">),</span> <span class="tok-n">mask1</span><span class="tok-p">);</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">mask1</span><span class="tok-p">;</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;g&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">gauss</span><span class="tok-p">);</span>
                <span class="tok-n">scaleAdd</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-o">/</span><span class="tok-mf">16.0</span><span class="tok-p">,</span> <span class="tok-n">Mat</span><span class="tok-o">::</span><span class="tok-n">zeros</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">CV_32F</span><span class="tok-p">),</span> <span class="tok-n">mask1</span><span class="tok-p">);</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">mask1</span><span class="tok-p">;</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;h&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">horizontal</span><span class="tok-p">);</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;v&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">vertical</span><span class="tok-p">);</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;l&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">laplacian</span><span class="tok-p">);</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;p&#39;</span><span class="tok-o">:</span>
                <span class="tok-n">menu</span><span class="tok-p">();</span>
                <span class="tok-cm">/* Aplica o filtro 5 x 5, que representa o gaussinado + laplaciano */</span>
                <span class="tok-n">mask</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-mi">5</span><span class="tok-p">,</span> <span class="tok-n">CV_32F</span><span class="tok-p">,</span> <span class="tok-n">laplgauss</span><span class="tok-p">);</span>
                <span class="tok-n">printMask</span><span class="tok-p">(</span><span class="tok-n">mask</span><span class="tok-p">);</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
            <span class="tok-k">default</span><span class="tok-o">:</span>
                <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-c1">// imwrite(&quot;Imagem_Filtro_Mediana.png&quot;,frameFiltered);</span>
    <span class="tok-c1">// imwrite(&quot;Imagem_Filtro_Vertical.png&quot;,frameFiltered);</span>
    <span class="tok-c1">//imwrite(&quot;Imagem_Filtro_Horizontal.png&quot;,frameFiltered);</span>
    <span class="tok-c1">//imwrite(&quot;Imagem_Filtro_Gauss.png&quot;,frameFiltered);</span>
    <span class="tok-c1">//imwrite(&quot;Imagem_Filtro_Laplaciano.png&quot;,frameFiltered);</span>
    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;Imagem_Filtro_LaplacianoGaussiano.png&quot;</span><span class="tok-p">,</span><span class="tok-n">frameFiltered</span><span class="tok-p">);</span>


    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia básica do programa é verificar a utilização dos diversos filtros espaciais definidos pelo professor no  link para o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/filtroespacial.cpp">filtroespacial.cpp</a>, através da operação de convolução discreta. A novidade foi a adição de um novo filtro: laplaciano do gaussiano. Esse filtro consiste em aplicar primeiro o filtro gaussiano a uma imagem e, em seguida, aplicar o filtro laplaciano no resultado anterior.</p>
</div>
<div class="paragraph">
<p>Para facilitar a implementação, em vez de realizar duas aplicações de filtragem com as máscaras já disponibilizadas pelo professor, foi gerada uma única máscara capaz de aplicar ambos os filtros de uma vez só. Essa máscara única foi obtida através da operação de convolução discreta entre as máscaras de gauss e laplaciana e isso só foi possível porque a operação de convolução admite a propriedade de associatividade. Logo, é possível convolver os dois filtros antes e, em seguida, convolver tal resultado com a imagem a ser processada.</p>
</div>
<div class="paragraph">
<p>As linhas 7 a 44 mostram os diferentes tipos de máscaras utilizadas, as quais são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Media</p>
</li>
<li>
<p>Gauss</p>
</li>
<li>
<p>Horizontal</p>
</li>
<li>
<p>Vertical</p>
</li>
<li>
<p>Laplaciano</p>
</li>
<li>
<p>Laplaciano do gaussiano</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As linhas 59 à 69 mostram a função menu para permitir o usuário escolher qual máscara vai ser utilizada. Nas linhas 96 à 99, tem-se o procedimento padrão para construção da matriz que será usada como máscara de filtragem.  A variável mask recebe uma matriz de tamanho 3x3 em ponto flutuante (CV_32F) com valores iniciais iguais ao do array media que é repassado. O tipo da matriz precisa ser estabelecido em ponto flutuante, posto que as operações de cálculo contarão com a presença de números fracionários.</p>
</div>
<div class="paragraph">
<p>O uso da função scaleAdd() serve para dar o ganho de 1/9 nos coeficientes do filtro da média. A operação multiplica o primeiro argumento pelo segundo, soma com o terceiro argumento (neste caso, uma matriz de zeros) e armazena o resultado no terceiro argumento, mask1. Logo em seguida, a troca entre as matrizes mask e mask1 ocorre para que use apenas a matriz mask no cálculo da convolução digital.</p>
</div>
<div class="paragraph">
<p>Por fim, na linha 101, ocorre a chamada da função menu() para pedir ao usuário que escolha o tipo de máscara a ser utilizada.</p>
</div>
<div class="paragraph">
<p>Nas linhas 106 e 107, as imagens coloridas capturadas pela camera do computador são enviadas a matriz <strong>cap</strong> e depois tem os seus pixels convertidos em tons de cinza pela função <strong>cvtColor</strong>. Nas linhas 110 e 111 tem-se um giro horizontal da imagem, através da função <strong>flip</strong>, apenas para melhor representação da imagem capturada. Da linha 112 à 115 ocorre o cálculo da filtragem espacial. A imagem em tom de cinza na variável <strong>frame</strong> é convertida para outra equivalente com representação em ponto flutuante - <strong>frame32f</strong>. A conversão é necessária devido aos tipos de operação que serão realizados pela função <strong>filter2D</strong>, que geram resultados em ponto flutuante.</p>
</div>
<div class="paragraph">
<p>A função0 <strong>filter2d</strong> recebe então a matriz da imagem em ponto flutuante - frame32f - e produz a matriz <strong>frameFiltered</strong>, de acordo com o tipo do elemento da matriz de entrada - neste caso, <strong>CV_32F</strong> (ou <em>float</em>). O objeto <strong>Point(1,1)</strong> que é repassado como próximo argumento identifica a origem do sistema de coordenadas atribuído para a máscara que, neste caso, é o ponto central da matriz.</p>
</div>
<div class="paragraph">
<p>Na linha 121 é feita uma conversão da matriz <strong>frameFiltered</strong> para CV_8U, que significa oito bits por pixel, ou seja, os pixels podem ir do valor 0 a 255, que é a forma que imagens e vídeos em escala de cinza são representados.</p>
</div>
<div class="paragraph">
<p>O restante do código apenas tem a função de apresentar o menu para o usuário escolher qual máscara aplicar. Ao fim do programa, a imagem mostrada na tela, com qualquer um dos filtros aplicados, é salva em disco (linha 178).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./laplgauss</p>
</li>
<li>
<p>Fotos de saída:</p>
</li>
</ul>
</div>
<div id="img-filtro-vertical" class="imageblock">
<div class="content">
<img src="./img/filtro-vertical.png" alt="Filtro Vertical">
</div>
<div class="title">Figura 10. Figura filtro-vertical.png</div>
</div>
<div id="img-filtro-horizontal" class="imageblock">
<div class="content">
<img src="./img/filtro-horizontal.png" alt="Filtro Horizontal">
</div>
<div class="title">Figura 11. Figura filtro-horizontal.png</div>
</div>
<div id="img-filtro-media" class="imageblock">
<div class="content">
<img src="./img/filtro-media.png" alt="Filtro da Média">
</div>
<div class="title">Figura 12. Figura filtro-media.png</div>
</div>
<div id="img-filtro-gaussiano" class="imageblock">
<div class="content">
<img src="./img/filtro-gaussiano.png" alt="Filtro Gaussiano">
</div>
<div class="title">Figura 13. Figura filtro-gaussiano.png</div>
</div>
<div id="img-filtro-laplaciano" class="imageblock">
<div class="content">
<img src="./img/filtro-laplaciano.png" alt="Filtro Laplaciano">
</div>
<div class="title">Figura 14. Figura filtro-laplaciano.png</div>
</div>
<div id="img-filtro-laplacianodogaussiano" class="imageblock">
<div class="content">
<img src="./img/filtro-laplacianodogaussiano.png" alt="Filtro Laplaciano do Gaussiano">
</div>
<div class="title">Figura 15. Figura filtro-laplacianodogaussiano.png</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filtragem_espacial_ii">Filtragem Espacial II</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_7_1_exercício_1">Seção 7.1 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/addweighted.cpp" target="_blank">exemplos/addweighted.cpp</a> como referência, implemente um programa tiltshift.cpp. Três ajustes deverão ser providos na tela da interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>um ajuste para regular a altura da região central que entrará em foco;</p>
</li>
<li>
<p>um ajuste para regular a força de decaimento da região borrada;</p>
</li>
<li>
<p>um ajuste para regular a posição vertical do centro da região que entrará em foco. Finalizado o programa, a imagem produzida deverá ser salva em arquivo.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>A partir do programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/addweighted.cpp" target="_blank">exemplos/addweighted.cpp</a>, disponibilizado pelo professor, e com base na teoria apresentada no capítulo em questão, o seguinte programa que aplica o efeito de <em>tilt-shift</em> foi desenvolvido:</p>
</div>
<div id="tiltshift" class="listingblock">
<div class="title">tiltshift.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;cmath&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-kt">double</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">forcaDecaimento</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">posicaoVerticalCentro</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">alfa</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderAlturaRegiaoCentralMax</span> <span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderForcaDecaimentoMax</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderPosicaoVerticalCentroMax</span><span class="tok-p">;</span>

<span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>
<span class="tok-kt">char</span> <span class="tok-n">nomeTrackbar</span><span class="tok-p">[</span><span class="tok-mi">50</span><span class="tok-p">];</span>

<span class="tok-cm">/* Faz o borramento da imagem utilizando filtro da média. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">borrarImagem</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Aumenta a saturação do quadro atual. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">aumentarSaturacao</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagemHSV</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">];</span>

    <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imagemFinal</span><span class="tok-p">,</span> <span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">COLOR_BGR2HSV</span><span class="tok-p">);</span>

    <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">hsv</span><span class="tok-p">);</span>
    <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">*</span> <span class="tok-mf">1.6</span><span class="tok-p">;</span>

    <span class="tok-n">merge</span><span class="tok-p">(</span><span class="tok-n">hsv</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">imagemHSV</span><span class="tok-p">);</span>

    <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">,</span> <span class="tok-n">COLOR_HSV2BGR</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Calcula a imagem final a partir da imagem original e de sua versão borrada,</span>
<span class="tok-cm">com as devidas ponderações escolhidas pelo usuário. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">calcularImagemFinal</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">xDeslocado</span><span class="tok-p">;</span>

    <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">xDeslocado</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-p">(</span><span class="tok-n">posicaoVerticalCentro</span> <span class="tok-o">+</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">);</span>

        <span class="tok-n">alfa</span> <span class="tok-o">=</span> <span class="tok-mf">0.5</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-n">tanh</span><span class="tok-p">((</span><span class="tok-n">xDeslocado</span> <span class="tok-o">+</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-n">forcaDecaimento</span><span class="tok-p">)</span>
            <span class="tok-o">-</span> <span class="tok-n">tanh</span><span class="tok-p">((</span><span class="tok-n">xDeslocado</span> <span class="tok-o">-</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-n">forcaDecaimento</span><span class="tok-p">));</span>

        <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">imagemFinal</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">alfa</span> <span class="tok-o">*</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span>
                <span class="tok-o">+</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-o">-</span><span class="tok-n">alfa</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-n">imagemBorrada</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">alturaRegiaoCentral</span> <span class="tok-o">=</span> <span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">;</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">aumentarSaturacao</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderForcaDecaimento</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">forcaDecaimento</span> <span class="tok-o">=</span> <span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">;</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">forcaDecaimento</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">forcaDecaimento</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">aumentarSaturacao</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderPosicaoVerticalCentro</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">posicaoVerticalCentro</span> <span class="tok-o">=</span> <span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">;</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">aumentarSaturacao</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">*</span> <span class="tok-n">argv</span><span class="tok-p">[]){</span>

    <span class="tok-cm">/* Verifica o número de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: &quot;</span>
        <span class="tok-s">&quot;./tiltshift &lt;imagem&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Checa se a imagem pode ser aberta. */</span>
    <span class="tok-n">imagem</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_COLOR</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">imagemFinal</span> <span class="tok-o">=</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>
    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Primeiramente faz o borramento da imagem original. */</span>
    <span class="tok-n">borrarImagem</span><span class="tok-p">();</span>

    <span class="tok-n">sliderAlturaRegiaoCentral</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-n">sliderForcaDecaimento</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-n">sliderPosicaoVerticalCentro</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>

    <span class="tok-n">sliderAlturaRegiaoCentralMax</span> <span class="tok-o">=</span> <span class="tok-n">imagemFinal</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span>
    <span class="tok-n">sliderPosicaoVerticalCentroMax</span> <span class="tok-o">=</span> <span class="tok-n">imagemFinal</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span>
    <span class="tok-n">sliderForcaDecaimentoMax</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Cria as barras de rolagem. */</span>
    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Altura&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">,</span>
        <span class="tok-n">sliderAlturaRegiaoCentralMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">(</span><span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Decaimento&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">,</span>
        <span class="tok-n">sliderForcaDecaimentoMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderForcaDecaimento</span> <span class="tok-p">);</span>
    <span class="tok-n">alterarSliderForcaDecaimento</span><span class="tok-p">(</span><span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span> <span class="tok-s">&quot;Centro&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">,</span>
        <span class="tok-n">sliderPosicaoVerticalCentroMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderPosicaoVerticalCentro</span> <span class="tok-p">);</span>
    <span class="tok-n">alterarSliderPosicaoVerticalCentro</span><span class="tok-p">(</span><span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Fecha o programa quando o usuário digita ESC. */</span>
    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">30</span><span class="tok-p">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
      <span class="tok-p">{</span>
        <span class="tok-k">break</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Salva a imagem processada. */</span>
    <span class="tok-n">imwrite</span><span class="tok-p">(</span><span class="tok-s">&quot;saida.png&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>


  <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia do efeito de <em>tilt-shift</em>, conforme descrito no <a href="http://agostinhobritojr.github.io/tutoriais/pdi/#_filtragem_no_domínio_espacial_ii" target="_blank">Capítulo 7</a>, consiste em "combinar a imagem original com sua versão filtrada com filtro passa-baixas, de sorte a produzir nas proximidades da borda o efeito do borramento enquanto se mantém na região central a imagem sem borramento".</p>
</div>
<div class="paragraph">
<p>Para tornar isso possível, o primeiro objetivo do programa é, então, receber uma imagem do usuário e imediatamente gerar sua versão filtrada, isto é, com efeito de borramento para que elas duas possam ser combinadas depois. Isso é feito na linha 122, através da função <strong>borrarImagem</strong>. Esta função, basicamente, aplica o fitro da média de tamanho \$3 times 3\$  seis vezes seguidas na imagem original, para provocar um borramento bem intenso.</p>
</div>
<div class="paragraph">
<p>Com a imagem original e a imagem borrada produzidas, o passo seguinte é aplicar a função \$g(x,y) = α(x)f(x,y) + (1−α(x))bf(x,y)\$, sendo \$g(x,y)\$ a imagem com efeito de tilt-shit aplicado, \$f(x,y)\$ a imagem original e \$bf(x,y)\$ a imagem original após o efeito de borramento. A forma sobre como ambas as imagens de entrada (a original e a versão borrada) serão combinadas depende da função \$α(x)\$, definida por \$α(x) = \frac{1}{2} (\frac{tanh(x)−l1}{d}−\frac{tanh(x)−l2}{d})\$, "onde \$l1\$ e \$l2\$ são as linhas cujo valor de \$α\$  assume valor em torno de 0.5, caso os dois valores possuam uma distância adequada um do outro, e \$d\$  indica a força do decaimento da região totalmente oriunda da imagem original para a região totalmente oriunda da imagem borrada".</p>
</div>
<div class="paragraph">
<p>No programa acima, o cálculo do \$α(x)\$ é feito na através da função <strong>calcularImagemFinal</strong>, definida na linha 52. Ela usará os parâmetros da função escolhidos pelo usuário através da mudança das barras de rolagem, calculará seu valor e gerará a imagem final resultante \$g(x,y)\$. Essa imagem gerada é sempre atualizada na janela do programa e, quando o usuário concluir sua configuração, ele pode pressionar qualquer teclada para encerrar o programa e salvar o resultado.</p>
</div>
<div class="paragraph">
<p>Por fim, vale ressaltar que, antes da imagem original ser processa, ocorre um aumento na sua saturação com o intuito de deixar as cores mais vivas. Isso é importante para tornar o efeito de <em>tilt-shift</em> mais realista.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Exemplo da janela de configuração dos parâmetros</p>
</div>
<div id="img-janela-tiltshift" class="imageblock">
<div class="content">
<img src="./img/janela-tiltshift.png" alt="Janela Tilt-shift">
</div>
<div class="title">Figura 16. Figura janela-tiltshift.png</div>
</div>
<div class="ulist">
<div class="title">Exemplo de execução 1</div>
<ul>
<li>
<p>Comando: ./tiltshift saopaulo.png</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-saopaulo" class="imageblock">
<div class="content">
<img src="./img/saopaulo.png" alt="São Paulo">
</div>
<div class="title">Figura 17. Figura saopaulo.png original</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Foto de saída:</p>
</li>
</ul>
</div>
<div id="img-saopaulo-tiltshift" class="imageblock">
<div class="content">
<img src="./img/saopaulo-tiltshift.png" alt="São Paulo - Tilt Shift">
</div>
<div class="title">Figura 18. Figura saopaulo.png após processamento</div>
</div>
<div class="ulist">
<div class="title">Exemplo de execução 2</div>
<ul>
<li>
<p>Comando: ./tiltshift china.png</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-china" class="imageblock">
<div class="content">
<img src="./img/china.png" alt="China">
</div>
<div class="title">Figura 19. Figura china.png original</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Foto de saída:</p>
</li>
</ul>
</div>
<div id="img-china-tiltshift" class="imageblock">
<div class="content">
<img src="./img/china-tiltshift.png" alt="China - Tilt Shift">
</div>
<div class="title">Figura 20. Figura china.png após processamento</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seção_7_1_exercício_2">Seção 7.1 - Exercício 2</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/addweighted.cpp" target="_blank">exemplos/addweighted.cpp</a> como referência, implemente um programa tiltshiftvideo.cpp. Tal programa deverá ser capaz de processar um arquivo de vídeo, produzir o efeito de tilt-shift nos quadros presentes e escrever o resultado em outro arquivo de vídeo. A ideia é criar um efeito de miniaturização de cenas. Descarte quadros em uma taxa que julgar conveniente para evidenciar o efeito de stop motion, comum em vídeos desse tipo.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A solução deste exercício é apenas uma adaptação do programa anterior (<a href="#tiltshift">tiltshift.cpp</a>), conforme pode ser visto a seguir:</p>
</div>
<div id="tiltshiftvideo" class="listingblock">
<div class="title">tiltshiftvideo.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;cmath&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-n">VideoCapture</span> <span class="tok-n">cap</span><span class="tok-p">;</span>
<span class="tok-n">VideoWriter</span> <span class="tok-n">saida</span><span class="tok-p">;</span>

<span class="tok-kt">double</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">forcaDecaimento</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">posicaoVerticalCentro</span><span class="tok-p">;</span>
<span class="tok-kt">double</span> <span class="tok-n">alfa</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderAlturaRegiaoCentralMax</span> <span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderForcaDecaimentoMax</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderPosicaoVerticalCentroMax</span><span class="tok-p">;</span>

<span class="tok-n">Mat</span> <span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>
<span class="tok-kt">char</span> <span class="tok-n">nomeTrackbar</span><span class="tok-p">[</span><span class="tok-mi">50</span><span class="tok-p">];</span>

<span class="tok-cm">/* Faz o borramento da imagem utilizando filtro da média. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">borrarImagem</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
    <span class="tok-n">blur</span><span class="tok-p">(</span><span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">imagemBorrada</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">),</span> <span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">));</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Aumenta a saturação do quadro atual. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">aumentarSaturacao</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">imagemHSV</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">];</span>

    <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imagemFinal</span><span class="tok-p">,</span> <span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">COLOR_BGR2HSV</span><span class="tok-p">);</span>

    <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">hsv</span><span class="tok-p">);</span>
    <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">hsv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-o">*</span> <span class="tok-mf">1.6</span><span class="tok-p">;</span>

    <span class="tok-n">merge</span><span class="tok-p">(</span><span class="tok-n">hsv</span><span class="tok-p">,</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-n">imagemHSV</span><span class="tok-p">);</span>

    <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imagemHSV</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">,</span> <span class="tok-n">COLOR_HSV2BGR</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Calcula a imagem final a partir da imagem original e de sua versão borrada,</span>
<span class="tok-cm">com as devidas ponderações escolhidas pelo usuário. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">calcularImagemFinal</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">xDeslocado</span><span class="tok-p">;</span>

    <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">xDeslocado</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-p">(</span><span class="tok-n">posicaoVerticalCentro</span> <span class="tok-o">+</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">);</span>

        <span class="tok-n">alfa</span> <span class="tok-o">=</span> <span class="tok-mf">0.5</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-n">tanh</span><span class="tok-p">((</span><span class="tok-n">xDeslocado</span> <span class="tok-o">+</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-n">forcaDecaimento</span><span class="tok-p">)</span>
            <span class="tok-o">-</span> <span class="tok-n">tanh</span><span class="tok-p">((</span><span class="tok-n">xDeslocado</span> <span class="tok-o">-</span> <span class="tok-n">alturaRegiaoCentral</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-n">forcaDecaimento</span><span class="tok-p">));</span>

        <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">imagemFinal</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">alfa</span> <span class="tok-o">*</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span>
                <span class="tok-o">+</span> <span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-o">-</span><span class="tok-n">alfa</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-n">imagemBorrada</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">alturaRegiaoCentral</span> <span class="tok-o">=</span> <span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">;</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderForcaDecaimento</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">forcaDecaimento</span> <span class="tok-o">=</span> <span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">;</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">forcaDecaimento</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">forcaDecaimento</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderPosicaoVerticalCentro</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">posicaoVerticalCentro</span> <span class="tok-o">=</span> <span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">;</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">*</span> <span class="tok-n">argv</span><span class="tok-p">[])</span>
<span class="tok-p">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">largura</span><span class="tok-p">,</span> <span class="tok-n">altura</span><span class="tok-p">,</span> <span class="tok-n">fourcc</span><span class="tok-p">,</span> <span class="tok-n">contador</span><span class="tok-p">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">fps</span><span class="tok-p">,</span> <span class="tok-n">quantidadeTotalQuadros</span><span class="tok-p">,</span> <span class="tok-n">quadroAtual</span><span class="tok-p">,</span> <span class="tok-n">percentagem</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Verifica o número de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: &quot;</span>
        <span class="tok-s">&quot;./tiltshiftvideo &lt;video&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Checa se o video pode ser aberto. */</span>

    <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">open</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]);</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">isOpened</span><span class="tok-p">()){</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;O vídeo não pôde ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Obtém algumas propriedades do vídeo carregado. */</span>
    <span class="tok-n">largura</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FRAME_WIDTH</span><span class="tok-p">);</span>
    <span class="tok-n">altura</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FRAME_HEIGHT</span><span class="tok-p">);</span>
    <span class="tok-n">fourcc</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FOURCC</span><span class="tok-p">);</span>
    <span class="tok-n">fps</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FPS</span><span class="tok-p">);</span>
    <span class="tok-n">quantidadeTotalQuadros</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_FRAME_COUNT</span><span class="tok-p">);</span>

    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Utiliza o primeiro frame como a imagem base para ajustar a região do</span>
<span class="tok-cm">     * efeito do tiltshift. */</span>
    <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>
    <span class="tok-n">imagemFinal</span> <span class="tok-o">=</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>
    <span class="tok-n">borrarImagem</span><span class="tok-p">();</span>
    <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
    <span class="tok-n">aumentarSaturacao</span><span class="tok-p">();</span>

    <span class="tok-n">sliderAlturaRegiaoCentralMax</span> <span class="tok-o">=</span> <span class="tok-n">altura</span><span class="tok-p">;</span>
    <span class="tok-n">sliderPosicaoVerticalCentroMax</span> <span class="tok-o">=</span> <span class="tok-n">altura</span><span class="tok-p">;</span>
    <span class="tok-n">sliderForcaDecaimentoMax</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Cria as barras de rolagem.  */</span>
    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Altura&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">,</span>
        <span class="tok-n">sliderAlturaRegiaoCentralMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderAlturaRegiaoCentral</span><span class="tok-p">(</span><span class="tok-n">sliderAlturaRegiaoCentral</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Decaimento&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">,</span>
        <span class="tok-n">sliderForcaDecaimentoMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderForcaDecaimento</span> <span class="tok-p">);</span>
    <span class="tok-n">alterarSliderForcaDecaimento</span><span class="tok-p">(</span><span class="tok-n">sliderForcaDecaimento</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span> <span class="tok-s">&quot;Centro&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">,</span>
        <span class="tok-n">sliderPosicaoVerticalCentroMax</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderPosicaoVerticalCentro</span> <span class="tok-p">);</span>
    <span class="tok-n">alterarSliderPosicaoVerticalCentro</span><span class="tok-p">(</span><span class="tok-n">sliderPosicaoVerticalCentro</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;[1] Selecionando regiões para efeito de tilt-shift...&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span> <span class="tok-p">;</span>

    <span class="tok-cm">/* Abre a janela para o usuário conseguir selecionar a região de efeito</span>
<span class="tok-cm">     * do tilt-shift. */</span>
    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
        <span class="tok-cm">/* If the values are set, then start video conversion. */</span>
        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">30</span><span class="tok-p">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">destroyWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">);</span>

            <span class="tok-cm">/* Única forma da janela fechar. */</span>
            <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Sobrescrevendo por falta de suporte ao MP4. */</span>
    <span class="tok-n">fourcc</span> <span class="tok-o">=</span> <span class="tok-n">CV_FOURCC</span><span class="tok-p">(</span><span class="tok-sc">&#39;P&#39;</span><span class="tok-p">,</span><span class="tok-sc">&#39;I&#39;</span><span class="tok-p">,</span><span class="tok-sc">&#39;M&#39;</span><span class="tok-p">,</span><span class="tok-sc">&#39;1&#39;</span><span class="tok-p">);</span>
    <span class="tok-n">saida</span> <span class="tok-o">=</span> <span class="tok-n">VideoWriter</span><span class="tok-p">(</span><span class="tok-s">&quot;saida.mpg&quot;</span><span class="tok-p">,</span> <span class="tok-n">fourcc</span><span class="tok-p">,</span> <span class="tok-n">fps</span><span class="tok-p">,</span> <span class="tok-n">Size</span><span class="tok-p">(</span><span class="tok-n">largura</span><span class="tok-p">,</span> <span class="tok-n">altura</span><span class="tok-p">));</span>

    <span class="tok-cm">/* Escreve o primeiro quadro. */</span>
    <span class="tok-n">saida</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>

    <span class="tok-n">contador</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cap</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-n">imagem</span><span class="tok-p">;</span>

        <span class="tok-cm">/* Simula o efeito de stop-motion. */</span>
        <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">contador</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">saida</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>
            <span class="tok-n">contador</span><span class="tok-o">++</span><span class="tok-p">;</span>
            <span class="tok-k">continue</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-cm">/* Verifica se a imagem foi toda processada. */</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">empty</span><span class="tok-p">())</span>
        <span class="tok-p">{</span>
            <span class="tok-k">break</span><span class="tok-p">;</span>
        <span class="tok-p">}</span>

        <span class="tok-cm">/* Faz o borramento da imagem. */</span>
        <span class="tok-n">borrarImagem</span><span class="tok-p">();</span>

        <span class="tok-cm">/* Gera o quadro com o efeito de tiltshift. */</span>
        <span class="tok-n">calcularImagemFinal</span><span class="tok-p">();</span>
        <span class="tok-n">aumentarSaturacao</span><span class="tok-p">();</span>
        <span class="tok-n">saida</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>
        <span class="tok-n">quadroAtual</span> <span class="tok-o">=</span> <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-n">CV_CAP_PROP_POS_FRAMES</span><span class="tok-p">);</span>
        <span class="tok-n">percentagem</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">*</span><span class="tok-n">quadroAtual</span><span class="tok-o">/</span><span class="tok-n">quantidadeTotalQuadros</span><span class="tok-p">;</span>

        <span class="tok-cm">/* Exibe o progresso atual do processamento. */</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;[2] Processando vídeo... &quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">round</span><span class="tok-p">(</span><span class="tok-n">percentagem</span><span class="tok-p">)</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot; % </span><span class="tok-se">\r</span><span class="tok-s">&quot;</span><span class="tok-p">;</span>
        <span class="tok-n">cout</span><span class="tok-p">.</span><span class="tok-n">flush</span><span class="tok-p">();</span>

        <span class="tok-n">contador</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">cap</span><span class="tok-p">.</span><span class="tok-n">release</span><span class="tok-p">();</span>
    <span class="tok-n">saida</span><span class="tok-p">.</span><span class="tok-n">release</span><span class="tok-p">();</span>

    <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;[3] Processamento do vídeo concluído.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>

    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia deste programa foi abrir um arquivo de vídeo e sair aplicando o efeito de <em>tilt-shift</em> do exemplo anterior a cada quadro do vídeo. Para isso, é apresentado usuário uma janela com o primeiro quadro do vídeo para ele definir como o filtro será aplicado (linha 164 à linha 179). Uma vez que isso é concluído, o usuário pressionar qualquer tecla para iniciar o processamento do vídeo (linha 189 a linha 222).</p>
</div>
<div class="paragraph">
<p>Durante o processamento, foi adicionado um pequeno trecho para descartar alguns quadros do vídeo para produzir um efeito de <em>stop-motion</em> (linha 194 à linha 199). Além disso, é exibido para o usuário o progresso atual do processamento em percentagem (linha 218), já que, dependendo do vídeo, isso pode demorar e é importante que o usuário consiga estimar o tempo total.</p>
</div>
<div class="paragraph">
<p>Ao final do programa, o vídeo resultante é salvo e o usuário pode executá-lo em qualquer player de vídeo. Um detalhe importante é que o OpenCV não trabalha com áudio, logo o resultado gerado é apenas uma vídeo sem áudio. No exemplo mostrado abaixo, foi necessário mesclar o vídeo resultante com o áudio do vídeo original através de outro programa editor de vídeo.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Exemplo da janela de configuração dos parâmetros que aparece no primeiro quadro do vídeo.</p>
</div>
<div id="img-janela-tiltshiftvideo" class="imageblock">
<div class="content">
<img src="./img/janela-tiltshiftvideo.png" alt="Janela Tilt-shift Vídeo">
</div>
<div class="title">Figura 21. Figura janela-tiltshiftvideo.png</div>
</div>
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./tiltshiftvideo congestionamento.mp4</p>
</li>
<li>
<p>Vídeo de entrada:</p>
</li>
</ul>
</div>
<div id="video-congestionamento" class="videoblock">
<div class="title">Vídeo congestionamento.mp4 original</div>
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/5tiWGREedi4?rel=0&amp;loop=1&amp;playlist=5tiWGREedi4" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Vídeo de saída:</p>
</li>
</ul>
</div>
<div id="video-congestionamento-tiltshift" class="videoblock">
<div class="title">Vídeo congestionamento.mp4 processado</div>
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/1ziU0PYewVU?rel=0&amp;loop=1&amp;playlist=1ziU0PYewVU" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filtragem_no_domínio_da_frequência">Filtragem no domínio da frequência</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_8_2_exercício_1">Seção 8.2 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Utilizando o programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/exemplos/dft.cpp" target="_blank">exemplos/dft.cpp</a> como referência, implemente o filtro homomórfico para melhorar imagens com iluminação irregular. Crie uma cena mal iluminada e ajuste os parâmetros do filtro homomórfico para corrigir a iluminação da melhor forma possível. Assuma que a imagem fornecida é em tons de cinza.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>A partir do programa <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/exemplos/dft.cpp" target="_blank">exemplos/dft.cpp</a>, disponibilizado pelo professor, e com base na teoria apresentada no capítulo em questão, o seguinte programa que aplica o efeito do filtro <em>homomórfico</em> foi desenvolvido:</p>
</div>
<div id="homomorfico" class="listingblock">
<div class="title">homomorfico.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>

<span class="tok-cp">#define GAMA_MAX 100</span>
<span class="tok-cp">#define C_MAX 100</span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>

<span class="tok-n">Mat</span> <span class="tok-n">complexImage</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">sliderGamaL</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderGamaH</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderD0</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sliderC</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>

<span class="tok-kt">float</span> <span class="tok-n">gamaH</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-kt">float</span> <span class="tok-n">gamaL</span> <span class="tok-o">=</span> <span class="tok-mf">0.5</span><span class="tok-p">;</span>
<span class="tok-kt">float</span> <span class="tok-n">D0</span> <span class="tok-o">=</span> <span class="tok-mf">0.2</span><span class="tok-p">;</span>
<span class="tok-kt">float</span> <span class="tok-n">C</span> <span class="tok-o">=</span> <span class="tok-mf">0.2</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">dft_M</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">dft_N</span><span class="tok-p">;</span>

<span class="tok-cm">/* Exibe o espectro da uma imagem complexa. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">exibirEspectro</span><span class="tok-p">(</span><span class="tok-n">Mat</span><span class="tok-o">&amp;</span> <span class="tok-n">complexI</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">espectro</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span>

    <span class="tok-n">deslocaDFT</span><span class="tok-p">(</span><span class="tok-n">complexI</span><span class="tok-p">);</span>

    <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">complexI</span><span class="tok-p">,</span> <span class="tok-n">planos</span><span class="tok-p">);</span>

    <span class="tok-n">magnitude</span><span class="tok-p">(</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">espectro</span><span class="tok-p">);</span>
    <span class="tok-n">Mat</span> <span class="tok-n">magI</span> <span class="tok-o">=</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>

    <span class="tok-n">magI</span> <span class="tok-o">+=</span> <span class="tok-n">Scalar</span><span class="tok-o">::</span><span class="tok-n">all</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-n">log</span><span class="tok-p">(</span><span class="tok-n">magI</span><span class="tok-p">,</span> <span class="tok-n">magI</span><span class="tok-p">);</span>

    <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">magI</span><span class="tok-p">,</span> <span class="tok-n">magI</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">CV_MINMAX</span><span class="tok-p">);</span>


    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;spectrum magnitude&quot;</span><span class="tok-p">,</span> <span class="tok-n">magI</span><span class="tok-p">);</span>

<span class="tok-p">}</span>

<span class="tok-cm">/* Troca os quadrantes da imagem da DFT. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">deslocaDFT</span><span class="tok-p">(</span><span class="tok-n">Mat</span><span class="tok-o">&amp;</span> <span class="tok-n">image</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
  <span class="tok-n">Mat</span> <span class="tok-n">tmp</span><span class="tok-p">,</span> <span class="tok-n">A</span><span class="tok-p">,</span> <span class="tok-n">B</span><span class="tok-p">,</span> <span class="tok-n">C</span><span class="tok-p">,</span> <span class="tok-n">D</span><span class="tok-p">;</span>

  <span class="tok-cm">/* Se a imagem tiver tamanho impar, recorta a regiao para</span>
<span class="tok-cm">   * evitar cópias de tamanho desigual. */</span>
  <span class="tok-n">image</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-n">cols</span> <span class="tok-o">&amp;</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-n">rows</span> <span class="tok-o">&amp;</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">));</span>
  <span class="tok-kt">int</span> <span class="tok-n">cx</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">;</span>
  <span class="tok-kt">int</span> <span class="tok-n">cy</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-p">;</span>

  <span class="tok-cm">/* reorganiza os quadrantes da transformada</span>
<span class="tok-cm">   * A B   -&gt;  D C</span>
<span class="tok-cm">   * C D       B A */</span>
  <span class="tok-n">A</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">));</span>
  <span class="tok-n">B</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">));</span>
  <span class="tok-n">C</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">,</span> <span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">));</span>
  <span class="tok-n">D</span> <span class="tok-o">=</span> <span class="tok-n">image</span><span class="tok-p">(</span><span class="tok-n">Rect</span><span class="tok-p">(</span><span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">,</span> <span class="tok-n">cx</span><span class="tok-p">,</span> <span class="tok-n">cy</span><span class="tok-p">));</span>

  <span class="tok-cm">/* A &lt;-&gt; D */</span>
  <span class="tok-n">A</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">tmp</span><span class="tok-p">);</span>  <span class="tok-n">D</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">A</span><span class="tok-p">);</span>  <span class="tok-n">tmp</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">D</span><span class="tok-p">);</span>

  <span class="tok-cm">/* C &lt;-&gt; B */</span>
  <span class="tok-n">C</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">tmp</span><span class="tok-p">);</span>  <span class="tok-n">B</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">C</span><span class="tok-p">);</span>  <span class="tok-n">tmp</span><span class="tok-p">.</span><span class="tok-n">copyTo</span><span class="tok-p">(</span><span class="tok-n">B</span><span class="tok-p">);</span>
<span class="tok-p">}</span>


<span class="tok-kt">void</span> <span class="tok-nf">aplicarFiltroHomomorfico</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-n">Mat</span> <span class="tok-n">filter</span><span class="tok-p">,</span> <span class="tok-n">complexImageTmp</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">;</span>
    <span class="tok-n">Mat</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span>

    <span class="tok-cm">/* Construção do filtro com base nos parâmetros. */</span>

    <span class="tok-n">Mat</span> <span class="tok-n">Du</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">complexImage</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">(),</span> <span class="tok-n">CV_32FC1</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>
    <span class="tok-n">Mat</span> <span class="tok-n">Du2</span><span class="tok-p">,</span> <span class="tok-n">expoente</span><span class="tok-p">,</span> <span class="tok-n">resultExp</span><span class="tok-p">,</span> <span class="tok-n">Hu</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Definição de Du. */</span>
    <span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">u</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">u</span> <span class="tok-o">&lt;</span> <span class="tok-n">dft_M</span><span class="tok-p">;</span> <span class="tok-n">u</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
		<span class="tok-k">for</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">v</span> <span class="tok-o">&lt;</span> <span class="tok-n">dft_N</span><span class="tok-p">;</span> <span class="tok-n">v</span><span class="tok-o">++</span><span class="tok-p">)</span>
		<span class="tok-p">{</span>
			<span class="tok-n">Du</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-kt">float</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">u</span><span class="tok-p">,</span> <span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">sqrt</span><span class="tok-p">(</span>
                <span class="tok-p">(</span><span class="tok-n">u</span> <span class="tok-o">-</span> <span class="tok-n">dft_M</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-p">(</span><span class="tok-n">u</span> <span class="tok-o">-</span> <span class="tok-n">dft_M</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">)</span> <span class="tok-o">+</span>
                <span class="tok-p">(</span><span class="tok-n">v</span> <span class="tok-o">-</span> <span class="tok-n">dft_N</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">)</span><span class="tok-o">*</span><span class="tok-p">(</span><span class="tok-n">v</span> <span class="tok-o">-</span> <span class="tok-n">dft_N</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-p">)</span>
            <span class="tok-p">);</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>

    <span class="tok-cm">/* Operações matemáticas para definidor o filtro homomórfico Hu. */</span>

	<span class="tok-n">multiply</span><span class="tok-p">(</span><span class="tok-n">Du</span><span class="tok-p">,</span> <span class="tok-n">Du</span><span class="tok-p">,</span> <span class="tok-n">Du2</span><span class="tok-p">);</span>
    <span class="tok-n">Du2</span> <span class="tok-o">=</span> <span class="tok-n">Du2</span> <span class="tok-o">/</span> <span class="tok-p">(</span><span class="tok-n">D0</span> <span class="tok-o">*</span> <span class="tok-n">D0</span><span class="tok-p">);</span>
	<span class="tok-n">expoente</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mf">1.0</span> <span class="tok-o">*</span> <span class="tok-n">C</span> <span class="tok-o">*</span> <span class="tok-n">Du2</span><span class="tok-p">;</span>
	<span class="tok-n">exp</span><span class="tok-p">(</span><span class="tok-n">expoente</span><span class="tok-p">,</span> <span class="tok-n">resultExp</span><span class="tok-p">);</span>

	<span class="tok-n">Hu</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">gamaH</span> <span class="tok-o">-</span> <span class="tok-n">gamaL</span><span class="tok-p">)</span> <span class="tok-o">*</span> <span class="tok-p">(</span><span class="tok-mi">1</span> <span class="tok-o">-</span> <span class="tok-n">resultExp</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-n">gamaL</span><span class="tok-p">;</span>

    <span class="tok-n">Mat</span> <span class="tok-n">comps</span><span class="tok-p">[]</span><span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-n">Hu</span><span class="tok-p">,</span> <span class="tok-n">Hu</span><span class="tok-p">};</span>
	<span class="tok-n">merge</span><span class="tok-p">(</span><span class="tok-n">comps</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">filter</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Aplica o filtro frequencial. */</span>
    <span class="tok-n">mulSpectrums</span><span class="tok-p">(</span><span class="tok-n">complexImage</span><span class="tok-p">,</span> <span class="tok-n">filter</span><span class="tok-p">,</span> <span class="tok-n">complexImageTmp</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">deslocaDFT</span><span class="tok-p">(</span><span class="tok-n">filter</span><span class="tok-p">);</span>
    <span class="tok-n">exibirEspectro</span><span class="tok-p">(</span><span class="tok-n">filter</span><span class="tok-p">);</span>

    <span class="tok-n">deslocaDFT</span><span class="tok-p">(</span><span class="tok-n">complexImageTmp</span><span class="tok-p">);</span>

	<span class="tok-cm">/* Calcula a DFT inversa. */</span>
    <span class="tok-n">idft</span><span class="tok-p">(</span><span class="tok-n">complexImageTmp</span><span class="tok-p">,</span> <span class="tok-n">complexImageTmp</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Separa os planos real (0) e complexo (1). */</span>
    <span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-n">complexImageTmp</span><span class="tok-p">,</span> <span class="tok-n">planos</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Aqui é necessário normalizar os valores do plano real, pois eles ainda</span>
<span class="tok-cm">     * serão submetidos a uma operação de exponenciação e altos valores gerariam</span>
<span class="tok-cm">     * uma falha de representação. */</span>
    <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">CV_MINMAX</span><span class="tok-p">);</span>

    <span class="tok-n">exp</span><span class="tok-p">(</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]);</span>

    <span class="tok-cm">/* Normaliza novamente para poder exibir o resultado final. */</span>
    <span class="tok-n">normalize</span><span class="tok-p">(</span><span class="tok-n">planos</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">],</span> <span class="tok-n">imagemFinal</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">CV_MINMAX</span><span class="tok-p">);</span>

    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">imagemFinal</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderGamaH</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">sliderGamaH</span> <span class="tok-o">&lt;</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">sliderGamaH</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">sliderGamaH</span> <span class="tok-o">&lt;=</span> <span class="tok-n">sliderGamaL</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">sliderGamaH</span> <span class="tok-o">=</span> <span class="tok-n">sliderGamaL</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-n">gamaH</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kt">float</span><span class="tok-p">)</span> <span class="tok-n">sliderGamaH</span><span class="tok-o">/</span><span class="tok-mf">10.0</span><span class="tok-p">;</span>
    <span class="tok-n">aplicarFiltroHomomorfico</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderGamaL</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">sliderGamaL</span> <span class="tok-o">&gt;=</span> <span class="tok-n">sliderGamaH</span><span class="tok-p">)</span>
	<span class="tok-p">{</span>
		<span class="tok-n">sliderGamaL</span> <span class="tok-o">=</span> <span class="tok-n">sliderGamaH</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
	<span class="tok-p">}</span>

	<span class="tok-n">gamaL</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kt">float</span><span class="tok-p">)</span> <span class="tok-n">sliderGamaL</span><span class="tok-o">/</span><span class="tok-mf">10.0</span><span class="tok-p">;</span>
	<span class="tok-n">aplicarFiltroHomomorfico</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderD0</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">sliderD0</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">sliderD0</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">D0</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kt">float</span><span class="tok-p">)</span> <span class="tok-n">sliderD0</span><span class="tok-o">/</span><span class="tok-mf">10.0</span><span class="tok-p">;</span>
    <span class="tok-n">aplicarFiltroHomomorfico</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderC</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
	<span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">sliderC</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">sliderC</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">C</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-kt">float</span><span class="tok-p">)</span> <span class="tok-n">sliderC</span><span class="tok-o">/</span><span class="tok-mf">1000.0</span><span class="tok-p">;</span>
    <span class="tok-n">aplicarFiltroHomomorfico</span><span class="tok-p">();</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">*</span> <span class="tok-n">argv</span><span class="tok-p">[])</span>
<span class="tok-p">{</span>

    <span class="tok-n">Mat</span>  <span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">padded</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Verifica o número de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: &quot;</span>
        <span class="tok-s">&quot;./homomorfico &lt;imagem&gt;&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Checa se a imagem pode ser aberta. */</span>
    <span class="tok-n">imagem</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_GRAYSCALE</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>


    <span class="tok-n">dft_M</span> <span class="tok-o">=</span> <span class="tok-n">getOptimalDFTSize</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">);</span>
    <span class="tok-n">dft_N</span> <span class="tok-o">=</span> <span class="tok-n">getOptimalDFTSize</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Realiza o padding da imagem. */</span>
    <span class="tok-n">copyMakeBorder</span><span class="tok-p">(</span><span class="tok-n">imagem</span><span class="tok-p">,</span> <span class="tok-n">padded</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
                 <span class="tok-n">dft_M</span> <span class="tok-o">-</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
                 <span class="tok-n">dft_N</span> <span class="tok-o">-</span> <span class="tok-n">imagem</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">,</span>
                 <span class="tok-n">BORDER_CONSTANT</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-o">::</span><span class="tok-n">all</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>

	<span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>


    <span class="tok-n">Mat</span> <span class="tok-n">planos</span><span class="tok-p">[]</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-n">Mat_</span><span class="tok-o">&lt;</span><span class="tok-kt">float</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">padded</span><span class="tok-p">),</span> <span class="tok-n">Mat</span><span class="tok-o">::</span><span class="tok-n">zeros</span><span class="tok-p">(</span><span class="tok-n">padded</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">(),</span> <span class="tok-n">CV_32F</span><span class="tok-p">)};</span>
    <span class="tok-n">merge</span><span class="tok-p">(</span><span class="tok-n">planos</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">,</span> <span class="tok-n">complexImage</span><span class="tok-p">);</span>         <span class="tok-c1">// Add to the expanded another plane with zeros</span>

    <span class="tok-n">log</span><span class="tok-p">(</span><span class="tok-n">complexImage</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">complexImage</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Calcula o DFT. */</span>
    <span class="tok-n">dft</span><span class="tok-p">(</span><span class="tok-n">complexImage</span><span class="tok-p">,</span> <span class="tok-n">complexImage</span><span class="tok-p">);</span>

    <span class="tok-n">deslocaDFT</span><span class="tok-p">(</span><span class="tok-n">complexImage</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Cria as barras de rolagem com todos os parâmetros. */</span>
    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;GamaH&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderGamaH</span><span class="tok-p">,</span>
        <span class="tok-n">GAMA_MAX</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderGamaH</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderGamaH</span><span class="tok-p">(</span><span class="tok-n">sliderGamaH</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;GamaL&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderGamaL</span><span class="tok-p">,</span>
        <span class="tok-n">GAMA_MAX</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderGamaL</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderGamaH</span><span class="tok-p">(</span><span class="tok-n">sliderGamaL</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;D0&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderD0</span><span class="tok-p">,</span>
        <span class="tok-n">dft_M</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderD0</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderD0</span><span class="tok-p">(</span><span class="tok-n">sliderD0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

	<span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;C&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span>
        <span class="tok-o">&amp;</span><span class="tok-n">sliderD0</span><span class="tok-p">,</span>
        <span class="tok-n">C_MAX</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderC</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderC</span><span class="tok-p">(</span><span class="tok-n">sliderC</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>


    <span class="tok-cm">/* Fecha o programa quando o usuário digita ESC. */</span>
    <span class="tok-k">while</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
      <span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-n">waitKey</span><span class="tok-p">(</span><span class="tok-mi">30</span><span class="tok-p">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">)</span>
      <span class="tok-p">{</span>
        <span class="tok-k">break</span><span class="tok-p">;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>

  <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia desse programa é realizar o tratamento de uma figura mal iluminada, com o objetivo de prover uma melhor distribuição da iluminação. Essa melhora é obtida após a aplicação de um filtro chamado de "homomórfico". A filtragem homomórfica baseia-se na ideia de poder melhorar a aparência de uma imagem com base no modelo de reflectância e iluminação. No domínio da frequência, é possível obter um controle simultâneo da compressão da faixa de intensidade e do contraste.</p>
</div>
<div class="paragraph">
<p>Primeiramente, uma imagem pode ser descrita como uma função \$f(x,y) = i(x,y)r(x,y)\$, em que \$i(x,y)\$ é a iluminância e \$r(x,y)\$ a reflectância. Dessa forma, ao aplicar a transformada de Fourier, tem-se o seguinte problema: \$F{f(x,y)}\neF{i(x,y)}F{r(x,y)}\$. A solução para este problema é considerar a seguinte função \$z(x,y)=ln{f(x,y)}\$, em que o valor de \$z(x,y)\$ vai ser igual a \$ln{i(x,y)} + ln{r(x,y)}\$.</p>
</div>
<div class="paragraph">
<p>A aplicação da transformada de Fourier no logaritmo acima gera o seguinte resultado: \$F{z(x,y)} = F{ln{i(x,y)}} + F{ln{r(x,y)}}\$, que pode ser visto na forma \$Z(u,v) = F_{i}(u,v) + F_{r}(u,v)\$. É neste resultado que se pode aplicar um filtro homomórfico do formato \$H(u,v)\$, o que gera a fórmula definitiva abaixo: \$S(u,v) = H(u,v)Z(u,v)\$, sendo \$H(u,v) = (\gamma_{H} - \gamma_{L})(1-e^{-c(\frac{(D^{2}(u,v))}{(D_{0})^2})}) + \gamma_{L}\$.  O termo c controla a inclinação da função à medida que existe a transição entre \$\gamma_{H}\$ e \$\gamma_{L}\$, o termo \$D_0\$ simboliza o raio do círculo do filtro passa alta, o termo \$D(u,v)\$ simboliza a distância entre um ponto \$(u,v)\$ no domínio da frequência e o centro do retângulo de frequência(nesse caso o ponto central da imagem) e por fim os termos \$\gamma_{H}\$ e \$\gamma_{L}\$ controlam a contribuição de de baixas frequências(iluminação) e de altas frequências(refletância).</p>
</div>
<div class="paragraph">
<p>Por fim, quando se aplica a transformada inversa de Fourier a imagem resultante representada pela função \$s(x,y)\$ tem de ser submetida a operação exponencial na base e, pois na função original \$z(x,y)\$ aplicou-se a operação logaritmo natural. Dessa forma, a função que define a nova imagem vai ser do tipo: \$g(x,y) = e^{s(x,y)}\$.</p>
</div>
<div class="paragraph">
<p>Após essa explicação introdutória sobre a filtragem homomórfica, o realiza todos os passos necessários:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aplica a função logaritmo neperiano em todos os pixels da imagem com a adição do número 1 em cada número para não haver erros ao aplicar a operação logaritmo no número 0 (linha 223).</p>
</li>
<li>
<p>Depois aplica-se a transformada de Fourier e faz o deslocamento das regiões, para facilitar a filtragem no domínio da frequência (linha 226 à 228).</p>
</li>
<li>
<p>Em seguida, a janela com o resultado é exibida com vários parâmetros para que o usuário possa realizar a configuração desejada (linha 230 à 253).</p>
</li>
<li>
<p>Finalmente, para cada parâmetro alterado, a função <strong>aplicarFiltroHomomorfico</strong> é chamada, de modo que o filtro é recriado com os novos parâmetros e um novo resultado final é gerado (linha 75 à 134).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Um fato importante a ser mencionado é que após o processamento no domínio da frequência, a imagem resultante após a transformação inversa de Fourier pode conter valores com altissimo módulo em ponto flutuante. Conforme explicado acima, é necessário aplicar a operação de exponenciação na base <em>e</em> em todos os píxels nesta etapa mas, dependendo do valor do píxeç, pode ser que o resultado não possa ser representado nem em float nem em double. Então, para evitar esse problema, é realizada uma normalização intermediária antes desses píxels passarem pela operação de exponenciação (linha 126 à linha 128). Ao fim de todo o processo, ainda é necessária uma última normalização para que o resultado possa ser exibido corretamente na tela.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução</div>
<ul>
<li>
<p>Comando: ./homomorfico cat.jpg</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-tunel" class="imageblock">
<div class="content">
<img src="./img/tunel.png" alt="Túnel">
</div>
<div class="title">Figura 22. Figura tunel.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Filtro passa altas homomórfico (como ficou o filtro para a configuração do resultado abaixo):</p>
</li>
</ul>
</div>
<div id="img-homomorfico-filtro" class="imageblock">
<div class="content">
<img src="./img/homomorfico-filtro.png" alt="Filtro Homomórfico">
</div>
<div class="title">Figura 23. Figura homomorfico-filtro.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Resultado:</p>
</li>
</ul>
</div>
<div id="img-homomorfico-tunel" class="imageblock">
<div class="content">
<img src="./img/homomorfico-tunnel.png" alt="Túnel homomórfico">
</div>
<div class="title">Figura 24. Figura homomorfico-tunnel.png</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_canny_e_a_arte_com_pontilhismo">Canny e a arte com pontilhismo</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_seção_11_1_exercício_1">Seção 11.1 - Exercício 1</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Utilizando os programas <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/canny.cpp" target="_blank">exemplos/canny.cpp</a> e <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/pontilhismo.cpp" target="_blank">exemplos/pontilhismo.cpp</a> como referência, implemente um programa cannypoints.cpp. A idéia é usar as bordas produzidas pelo algoritmo de Canny para melhorar a qualidade da imagem pontilhista gerada. A forma como a informação de borda será usada é livre. Entretanto, são apresentadas algumas sugestões de técnicas que poderiam ser utilizadas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Desenhar pontos grandes na imagem pontilhista básica;</p>
</li>
<li>
<p>Usar a posição dos pixels de borda encontrados pelo algoritmo de Canny para desenhar pontos nos respectivos locais na imagem gerada.</p>
</li>
<li>
<p>Experimente ir aumentando os limiares do algoritmo de Canny e, para cada novo par de limiares, desenhar círculos cada vez menores nas posições encontradas. A Figura Pontilhismo aplicado à imagem Lena foi desenvolvida usando essa técnica.</p>
</li>
<li>
<p>Escolha uma imagem de seu gosto e aplique a técnica que você desenvolveu.</p>
</li>
<li>
<p>Descreva no seu relatório detalhes do procedimento usado para criar sua técnica pontilhista.</p>
</li>
</ul>
</div>
<div id="img-lenna-pontilhismo" class="imageblock">
<div class="content">
<img src="./img/lenna-pontilhismo.png" alt="Lenna Pontilhismo">
</div>
<div class="title">Figura 25. Figura lenna-pontilhismo.png</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Combinando as funcionalidades fornecidas nos programas <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/canny.cpp" target="_blank">exemplos/canny.cpp</a> e <a href="http://agostinhobritojr.github.io/tutoriais/pdi/exemplos/pontilhismo.cpp" target="_blank">exemplos/pontilhismo.cpp</a>, o seguinte programa abaixo foi desenvolvido:</p>
</div>
<div id="cannypoints" class="listingblock">
<div class="title">cannypoints.cpp</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</div></td><td class="code"><span></span><span class="tok-cp">#include</span> <span class="tok-cpf">&lt;iostream&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;vector&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;numeric&gt;</span><span class="tok-cp"></span>
<span class="tok-cp">#include</span> <span class="tok-cpf">&lt;ctime&gt;</span><span class="tok-cp"></span>

<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">std</span><span class="tok-p">;</span>
<span class="tok-k">using</span> <span class="tok-k">namespace</span> <span class="tok-n">cv</span><span class="tok-p">;</span>

<span class="tok-cm">/* Matrizes usadas para armazenadas as imagens, bordas, etc. */</span>
<span class="tok-n">Mat</span> <span class="tok-n">imageGray</span><span class="tok-p">,</span> <span class="tok-n">imageColor</span><span class="tok-p">,</span> <span class="tok-n">border</span><span class="tok-p">,</span> <span class="tok-n">points</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">;</span>

<span class="tok-cm">/* Slider usado para configurar o limiar do algoritmo de Canny. */</span>
<span class="tok-kt">int</span> <span class="tok-n">threshold_slider</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">threshold_slider_max</span> <span class="tok-o">=</span> <span class="tok-mi">200</span><span class="tok-p">;</span>

<span class="tok-cm">/* Sliders usado para configurar o efeito de pontilhismo. */</span>
<span class="tok-kt">int</span> <span class="tok-n">step_slider</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">step_slider_max</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">jitter_slider</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">jitter_slider_max</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">raio_slider</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
<span class="tok-kt">int</span> <span class="tok-n">raio_slider_max</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-p">;</span>

<span class="tok-kt">int</span> <span class="tok-n">raio_borda</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-p">;</span>

<span class="tok-cm">/* Altera o raio do pontilhismo na borda da imagem de acordo com o limiar</span>
<span class="tok-cm"> * do algoritmo de Canny. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">mudar_raio_borda</span><span class="tok-p">()</span>
<span class="tok-p">{</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">threshold_slider</span> <span class="tok-o">&lt;</span> <span class="tok-mi">50</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">raio_borda</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">threshold_slider</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">50</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">threshold_slider</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">raio_borda</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">threshold_slider</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">100</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">threshold_slider</span> <span class="tok-o">&lt;</span> <span class="tok-mi">150</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">raio_borda</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
    <span class="tok-k">else</span>
    <span class="tok-p">{</span>
        <span class="tok-n">raio_borda</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Função chamada quando o limiar do algortimo de Canny é alterado. Nela,</span>
<span class="tok-cm"> * a imagem com o resultado final é gerada novamente. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderCanny</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">Canny</span><span class="tok-p">(</span><span class="tok-n">imageGray</span><span class="tok-p">,</span> <span class="tok-n">border</span><span class="tok-p">,</span> <span class="tok-n">threshold_slider</span><span class="tok-p">,</span> <span class="tok-mi">3</span> <span class="tok-o">*</span> <span class="tok-n">threshold_slider</span><span class="tok-p">);</span>
    <span class="tok-n">resultado</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>
    <span class="tok-n">uchar</span> <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">g</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">;</span>
    <span class="tok-n">Vec3b</span> <span class="tok-n">colors</span><span class="tok-p">;</span>

    <span class="tok-n">mudar_raio_borda</span><span class="tok-p">();</span>

    <span class="tok-cm">/* Recria o efeito o pontilhismo, modificando as bordas. */</span>
    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">border</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">border</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span> <span class="tok-n">j</span><span class="tok-o">++</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>

            <span class="tok-cm">/* Existe borda onde a cor do píxel é branca (255). */</span>
            <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">border</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">uchar</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">255</span><span class="tok-p">)</span>
            <span class="tok-p">{</span>

                <span class="tok-cm">/* Separa os 3 canais de cores. */</span>
                <span class="tok-n">colors</span> <span class="tok-o">=</span> <span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">);</span>
                <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
                <span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span>
                <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span>

                <span class="tok-cm">/* Cria o círculo em cima da borda. */</span>
                <span class="tok-n">circle</span><span class="tok-p">(</span><span class="tok-n">resultado</span><span class="tok-p">,</span> <span class="tok-n">cv</span><span class="tok-o">::</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">j</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-p">),</span> <span class="tok-n">raio_borda</span><span class="tok-p">,</span> <span class="tok-n">CV_RGB</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">g</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">),</span>
                <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">CV_AA</span><span class="tok-p">);</span>
            <span class="tok-p">}</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;canny&quot;</span><span class="tok-p">,</span> <span class="tok-n">border</span><span class="tok-p">);</span>
    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-n">resultado</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-cm">/* Função chamada quando algum parâmetro do efeito de pontilhismo é alterado.</span>
<span class="tok-cm"> * Ao fim, o resultado final é gerado novamente através da chamada da função</span>
<span class="tok-cm"> * alterarSliderCanny. */</span>
<span class="tok-kt">void</span> <span class="tok-nf">alterarSliderPointilhismo</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">void</span><span class="tok-o">*</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-kt">int</span><span class="tok-o">&gt;</span> <span class="tok-n">yrange</span><span class="tok-p">;</span>
    <span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-kt">int</span><span class="tok-o">&gt;</span> <span class="tok-n">xrange</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">width</span><span class="tok-p">,</span> <span class="tok-n">height</span><span class="tok-p">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-p">;</span>
    <span class="tok-n">uchar</span> <span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">g</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">;</span>
    <span class="tok-n">Vec3b</span> <span class="tok-n">colors</span><span class="tok-p">;</span>

    <span class="tok-cm">/* Evite que o passo seja menor que 1. */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">step_slider</span> <span class="tok-o">&lt;</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">step_slider</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">srand</span><span class="tok-p">(</span><span class="tok-n">time</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">));</span>

    <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">cols</span><span class="tok-p">;</span>
    <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">rows</span><span class="tok-p">;</span>

    <span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">resize</span><span class="tok-p">(</span><span class="tok-n">height</span> <span class="tok-o">/</span> <span class="tok-n">step_slider</span><span class="tok-p">);</span>
    <span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">resize</span><span class="tok-p">(</span><span class="tok-n">width</span> <span class="tok-o">/</span> <span class="tok-n">step_slider</span><span class="tok-p">);</span>

    <span class="tok-cm">/* Preenche ambos os vetores com 0&#39;s. */</span>
    <span class="tok-n">iota</span><span class="tok-p">(</span><span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">(),</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-n">iota</span><span class="tok-p">(</span><span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">(),</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">uint</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">();</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">xrange</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">xrange</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">*</span> <span class="tok-n">step_slider</span> <span class="tok-o">+</span> <span class="tok-n">step_slider</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">uint</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">();</span> <span class="tok-n">i</span><span class="tok-o">++</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">yrange</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">yrange</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">]</span> <span class="tok-o">*</span> <span class="tok-n">step_slider</span> <span class="tok-o">+</span> <span class="tok-n">step_slider</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">points</span> <span class="tok-o">=</span> <span class="tok-n">Mat</span><span class="tok-p">(</span><span class="tok-n">height</span><span class="tok-p">,</span> <span class="tok-n">width</span><span class="tok-p">,</span> <span class="tok-n">CV_8UC3</span><span class="tok-p">,</span> <span class="tok-n">Scalar</span><span class="tok-p">(</span><span class="tok-mi">255</span><span class="tok-p">,</span> <span class="tok-mi">255</span><span class="tok-p">,</span> <span class="tok-mi">255</span><span class="tok-p">));</span>

    <span class="tok-n">random_shuffle</span><span class="tok-p">(</span><span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">xrange</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">());</span>

    <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-k">auto</span> <span class="tok-nl">i</span> <span class="tok-p">:</span> <span class="tok-n">xrange</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">random_shuffle</span><span class="tok-p">(</span><span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span> <span class="tok-n">yrange</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">());</span>
        <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-k">auto</span> <span class="tok-nl">j</span> <span class="tok-p">:</span> <span class="tok-n">yrange</span><span class="tok-p">)</span>
        <span class="tok-p">{</span>
            <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-n">rand</span><span class="tok-p">()</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-mi">2</span> <span class="tok-o">*</span> <span class="tok-n">jitter_slider</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-n">jitter_slider</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>
            <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">j</span> <span class="tok-o">+</span> <span class="tok-n">rand</span><span class="tok-p">()</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-mi">2</span> <span class="tok-o">*</span> <span class="tok-n">jitter_slider</span><span class="tok-p">)</span> <span class="tok-o">-</span> <span class="tok-n">jitter_slider</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-p">;</span>

            <span class="tok-n">colors</span> <span class="tok-o">=</span> <span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">at</span><span class="tok-o">&lt;</span><span class="tok-n">Vec3b</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">j</span><span class="tok-p">);</span>
            <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">];</span>
            <span class="tok-n">g</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">];</span>
            <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">colors</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">];</span>

            <span class="tok-n">circle</span><span class="tok-p">(</span><span class="tok-n">points</span><span class="tok-p">,</span> <span class="tok-n">cv</span><span class="tok-o">::</span><span class="tok-n">Point</span><span class="tok-p">(</span><span class="tok-n">y</span><span class="tok-p">,</span> <span class="tok-n">x</span><span class="tok-p">),</span> <span class="tok-n">raio_slider</span><span class="tok-p">,</span> <span class="tok-n">CV_RGB</span><span class="tok-p">(</span><span class="tok-n">r</span><span class="tok-p">,</span> <span class="tok-n">g</span><span class="tok-p">,</span> <span class="tok-n">b</span><span class="tok-p">),</span>
            <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">CV_AA</span><span class="tok-p">);</span>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>

    <span class="tok-n">imshow</span><span class="tok-p">(</span><span class="tok-s">&quot;pontilhismo&quot;</span><span class="tok-p">,</span> <span class="tok-n">points</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderCanny</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-kt">int</span> <span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-kt">int</span> <span class="tok-n">argc</span><span class="tok-p">,</span> <span class="tok-kt">char</span><span class="tok-o">**</span> <span class="tok-n">argv</span><span class="tok-p">)</span>
<span class="tok-p">{</span>

    <span class="tok-cm">/* Verifica o número de argumentos.  */</span>
    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-n">argc</span> <span class="tok-o">!=</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A lista de argumentos deve ser: &quot;</span>
            <span class="tok-s">&quot;./cannypoints &lt;imagem&gt;&quot;</span><span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Checa se a imagem pode ser aberta. */</span>
    <span class="tok-n">imageColor</span> <span class="tok-o">=</span> <span class="tok-n">imread</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-n">CV_LOAD_IMAGE_COLOR</span><span class="tok-p">);</span>

    <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-o">!</span><span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">data</span><span class="tok-p">)</span>
    <span class="tok-p">{</span>
        <span class="tok-n">cout</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-s">&quot;A imagem não pode ser aberta.&quot;</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-n">endl</span><span class="tok-p">;</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-cm">/* Mantenha a imagem original em dois formatos: em escala de cinza e</span>
<span class="tok-cm">     * colorido. A em escala de cinza será usada na detecção de bordas. */</span>
    <span class="tok-n">cvtColor</span><span class="tok-p">(</span><span class="tok-n">imageColor</span><span class="tok-p">,</span> <span class="tok-n">imageGray</span><span class="tok-p">,</span> <span class="tok-n">CV_BGR2GRAY</span><span class="tok-p">);</span>

    <span class="tok-n">points</span> <span class="tok-o">=</span> <span class="tok-n">imageColor</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>
    <span class="tok-n">border</span> <span class="tok-o">=</span> <span class="tok-n">imageGray</span><span class="tok-p">.</span><span class="tok-n">clone</span><span class="tok-p">();</span>

    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;canny&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;pontilhismo&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>
    <span class="tok-n">namedWindow</span><span class="tok-p">(</span><span class="tok-s">&quot;resultado&quot;</span><span class="tok-p">,</span> <span class="tok-mi">1</span><span class="tok-p">);</span>

    <span class="tok-n">Canny</span><span class="tok-p">(</span><span class="tok-n">imageGray</span><span class="tok-p">,</span> <span class="tok-n">border</span><span class="tok-p">,</span> <span class="tok-n">threshold_slider</span><span class="tok-p">,</span> <span class="tok-mi">3</span> <span class="tok-o">*</span> <span class="tok-n">threshold_slider</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Treshold inferior&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;canny&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">threshold_slider</span><span class="tok-p">,</span>
        <span class="tok-n">threshold_slider_max</span><span class="tok-p">,</span> <span class="tok-n">alterarSliderCanny</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Step&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;pontilhismo&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">step_slider</span><span class="tok-p">,</span> <span class="tok-n">step_slider_max</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderPointilhismo</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Jitter&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;pontilhismo&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">jitter_slider</span><span class="tok-p">,</span> <span class="tok-n">jitter_slider_max</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderPointilhismo</span><span class="tok-p">);</span>

    <span class="tok-n">createTrackbar</span><span class="tok-p">(</span><span class="tok-s">&quot;Raio&quot;</span><span class="tok-p">,</span> <span class="tok-s">&quot;pontilhismo&quot;</span><span class="tok-p">,</span> <span class="tok-o">&amp;</span><span class="tok-n">raio_slider</span><span class="tok-p">,</span> <span class="tok-n">raio_slider_max</span><span class="tok-p">,</span>
        <span class="tok-n">alterarSliderPointilhismo</span><span class="tok-p">);</span>


    <span class="tok-n">alterarSliderPointilhismo</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>
    <span class="tok-n">alterarSliderCanny</span><span class="tok-p">(</span><span class="tok-n">threshold_slider</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">);</span>

    <span class="tok-n">waitKey</span><span class="tok-p">();</span>
    <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ideia do programa acima é gerar o efeito de pontilhismo em uma imagem fornecida pelo usuário, com a opção de configurar vários parâmetros em tempo real para se obter o melhor resultado desejado. Para obter isso, é necessário realizar algumas etapas sugeridas pelo enunciado desta questão.</p>
</div>
<div class="paragraph">
<p>Inicialmente, a imagem original é lida no formato colorido e, em seguida, é feita uma cópia dela, mas em escala de cinza (linha 177), para facilitar o algortimo de detecção de bordad de Canny a ser aplicado posteriormente. Após isso, são criadas 3 janelas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"canny" - Janela onde o usuário definirá o limiar inferior do algortimo de Canny.</p>
</li>
<li>
<p>"pontilhismo" - Janela onde o usuário definirá parâmetros do efeito de desenhar desenhar círculos (a forma como o pontilhismo é aplicado).</p>
</li>
<li>
<p>"resultado" - Janela onde o usuário vê o resultado final, a partir da combinação das configurações das duas outras janelas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Após isso, são configurados os <em>sliders</em> nas janelas em questão (da linha 188 à 198), o que finaliza a inicialização do programa. O primeiro <em>slider</em> é responsável pelo limiar do algoritmo de Canny, enquanto os outros 3 são responsáveis pelo efeito de desenho dos círculos.</p>
</div>
<div class="paragraph">
<p>A função <strong>alterarSliderCanny</strong>, que é chamada toda vez que o limiar de Canny é alterado, faz a detecção de bordas da imagem original que foi convertida em escala de cinza. Após isso, o efeito do pontilhismo é aplicado na borda da imagem que já passara pelo efeito de pontilhismo definido na janela pontilhismo (essa imagem com efeito de pontilhismo está como colorida). É importante ressaltar que, seguindo a sugestão do enunciado, o tamanho do circulo a ser colocado na borda vai diminuindo conforme o limiar do algoritmo vai aumentando. Isso é feito pela função <strong>mudar_raio_borda</strong>, que sempre é chamada quando há alteração de limiar (linha 60). Ao fim, a imagem resultante é exibida novamente na janela "resultado".</p>
</div>
<div class="paragraph">
<p>Por fim, a função <strong>alterarSliderPointilhismo</strong> é invocada quando há alteração em alguns dos parâmetros do efeito de pontilhismo. Com os valores de <strong>step</strong>, <strong>jitter</strong> e <strong>raio</strong> definidos, alguns píxels da imagem original são substituídos por círculos em uma ordem aleatória para melhorar o efeito. Com isso, a imagem resultante precisa ser recalculada e isso é feito através da função <strong>alterarSliderCanny</strong>, que é forçadamente chamada ao fim (linha 152).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<div class="title">Exemplo de execução 1</div>
<ul>
<li>
<p>Comando: ./cannypoints pontilhismo-lara.jpg</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-lara" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-lara.jpg" alt="Lara">
</div>
<div class="title">Figura 26. Figura pontilhismo-lara.jpg</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela de configuração do efeito de pontilhismo</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-parametros-lara" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-parametros-lara.png" alt="Parâmetros Lara">
</div>
<div class="title">Figura 27. Figura pontilhismo-parametros-lara.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela de configuração do limiar do algortimo de Canny</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-canny-lara" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-canny-lara.png" alt="Canny Lara">
</div>
<div class="title">Figura 28. Figura pontilhismo-canny-lara.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela com o resultado final</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-resultado-lara" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-resultado-lara.png" alt="Resultado Lara">
</div>
<div class="title">Figura 29. Figura pontilhismo-resultado-lara.png</div>
</div>
<div class="ulist">
<div class="title">Exemplo de execução 2</div>
<ul>
<li>
<p>Comando: ./cannypoints pontilhismo-gow.png</p>
</li>
<li>
<p>Foto de entrada:</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-gow" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-gow.jpg" alt="GOW">
</div>
<div class="title">Figura 30. Figura pontilhismo-gow.jpg</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela de configuração do efeito de pontilhismo</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-parametros-gow" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-parametros-gow.png" alt="Parâmetros GOW">
</div>
<div class="title">Figura 31. Figura pontilhismo-parametros-gow.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela de configuração do limiar do algortimo de Canny</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-canny-gow" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-canny-gow.png" alt="Canny GOW">
</div>
<div class="title">Figura 32. Figura pontilhismo-canny-gow.png</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Janela com o resultado final</p>
</li>
</ul>
</div>
<div id="img-pontilhismo-resultado-gow" class="imageblock">
<div class="content">
<img src="./img/pontilhismo-resultado-gow.png" alt="Resultado GOW">
</div>
<div class="title">Figura 33. Figura pontilhismo-resultado-gow.png</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-05-09 00:08:44 -03
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>